!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=9)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DEFAULT_COLOR=256,e.DEFAULT_ATTR=256|e.DEFAULT_COLOR<<9,e.CHAR_DATA_ATTR_INDEX=0,e.CHAR_DATA_CHAR_INDEX=1,e.CHAR_DATA_WIDTH_INDEX=2,e.CHAR_DATA_CODE_INDEX=3,e.NULL_CELL_CHAR="",e.NULL_CELL_WIDTH=1,e.NULL_CELL_CODE=0,e.WHITESPACE_CELL_CHAR=" ",e.WHITESPACE_CELL_WIDTH=1,e.WHITESPACE_CELL_CODE=32},function(t,e,i){"use strict";function s(t,e,i){const s=r(t.createShader(e));if(t.shaderSource(s,i),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS))return s;console.error(t.getShaderInfoLog(s)),t.deleteShader(s)}function r(t){if(!t)throw new Error("value must not be falsy");return t}Object.defineProperty(e,"__esModule",{value:!0}),e.PROJECTION_MATRIX=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]),e.createProgram=function(t,e,i){const o=r(t.createProgram());if(t.attachShader(o,r(s(t,t.VERTEX_SHADER,e))),t.attachShader(o,r(s(t,t.FRAGMENT_SHADER,i))),t.linkProgram(o),t.getProgramParameter(o,t.LINK_STATUS))return o;console.error(t.getProgramInfoLog(o)),t.deleteProgram(o)},e.createShader=s,e.expandFloat32Array=function(t,e){const i=Math.min(2*t.length,e),s=new Float32Array(i);for(let e=0;e<t.length;e++)s[e]=t[e];return s},e.throwIfFalsy=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(3);e.RENDER_MODEL_INDICIES_PER_CELL=3,e.RENDER_MODEL_BG_OFFSET=1,e.RENDER_MODEL_FG_OFFSET=2,e.COMBINED_CHAR_BIT_MASK=2147483648;e.RenderModel=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection={hasSelection:!1,viewportStartRow:0,viewportEndRow:0,viewportCappedStartRow:0,viewportCappedEndRow:0,startCol:0,endCol:0}}resize(t,i){const s=t*i*e.RENDER_MODEL_INDICIES_PER_CELL;s!==this.cells.length&&(this.cells=new Uint32Array(s),this.lineLengths=new Uint32Array(i))}clear(){s.fill(this.cells,0,0),s.fill(this.lineLengths,0,0),this.clearSelection()}clearSelection(){this.selection.hasSelection=!1,this.selection.viewportStartRow=0,this.selection.viewportEndRow=0,this.selection.viewportCappedStartRow=0,this.selection.viewportCappedEndRow=0,this.selection.startCol=0,this.selection.endCol=0}}},function(t,e,i){"use strict";function s(t,e,i,s){if(void 0===i&&(i=0),void 0===s&&(s=t.length),i>=t.length)return t;i=(t.length+i)%t.length,s=s>=t.length?t.length:(t.length+s)%t.length;for(var r=i;r<s;++r)t[r]=e;return t}Object.defineProperty(e,"__esModule",{value:!0}),e.fill=function(t,e,i,r){return t.fill?t.fill(e,i,r):s(t,e,i,r)},e.fillFallback=s,e.concat=function(t,e){var i=new t.constructor(t.length+e.length);return i.set(t),i.set(e,t.length),i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.INVERTED_DEFAULT_COLOR=257,e.DIM_OPACITY=.5,e.CHAR_ATLAS_CELL_SPACING=1},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),r=i(1);e.BaseRenderLayer=class{constructor(t,e,i,s,r){this._container=t,this._alpha=s,this._colors=r,this._scaledCharWidth=0,this._scaledCharHeight=0,this._scaledCellWidth=0,this._scaledCellHeight=0,this._scaledCharLeft=0,this._scaledCharTop=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add(`xterm-${e}-layer`),this._canvas.style.zIndex=i.toString(),this._initCanvas(),this._container.appendChild(this._canvas)}dispose(){this._container.removeChild(this._canvas),this._charAtlas&&this._charAtlas.dispose()}_initCanvas(){this._ctx=r.throwIfFalsy(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}onOptionsChanged(t){}onBlur(t){}onFocus(t){}onCursorMove(t){}onGridChanged(t,e,i){}onSelectionChanged(t,e,i,s=!1){}setColors(t,e){this._refreshCharAtlas(t,e)}_setTransparency(t,e){if(e===this._alpha)return;const i=this._canvas;this._alpha=e,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,i),this._refreshCharAtlas(t,this._colors),this.onGridChanged(t,0,t.rows-1)}_refreshCharAtlas(t,e){this._scaledCharWidth<=0&&this._scaledCharHeight<=0||(this._charAtlas=s.acquireCharAtlas(t,e,this._scaledCharWidth,this._scaledCharHeight),this._charAtlas.warmUp())}resize(t,e){this._scaledCellWidth=e.scaledCellWidth,this._scaledCellHeight=e.scaledCellHeight,this._scaledCharWidth=e.scaledCharWidth,this._scaledCharHeight=e.scaledCharHeight,this._scaledCharLeft=e.scaledCharLeft,this._scaledCharTop=e.scaledCharTop,this._canvas.width=e.scaledCanvasWidth,this._canvas.height=e.scaledCanvasHeight,this._canvas.style.width=`${e.canvasWidth}px`,this._canvas.style.height=`${e.canvasHeight}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(t,this._colors)}_fillCells(t,e,i,s){this._ctx.fillRect(t*this._scaledCellWidth,e*this._scaledCellHeight,i*this._scaledCellWidth,s*this._scaledCellHeight)}_fillBottomLineAtCells(t,e,i=1){this._ctx.fillRect(t*this._scaledCellWidth,(e+1)*this._scaledCellHeight-window.devicePixelRatio-1,i*this._scaledCellWidth,window.devicePixelRatio)}_fillLeftLineAtCell(t,e){this._ctx.fillRect(t*this._scaledCellWidth,e*this._scaledCellHeight,window.devicePixelRatio,this._scaledCellHeight)}_strokeRectAtCell(t,e,i,s){this._ctx.lineWidth=window.devicePixelRatio,this._ctx.strokeRect(t*this._scaledCellWidth+window.devicePixelRatio/2,e*this._scaledCellHeight+window.devicePixelRatio/2,i*this._scaledCellWidth-window.devicePixelRatio,s*this._scaledCellHeight-window.devicePixelRatio)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(t,e,i,s){this._alpha?this._ctx.clearRect(t*this._scaledCellWidth,e*this._scaledCellHeight,i*this._scaledCellWidth,s*this._scaledCellHeight):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(t*this._scaledCellWidth,e*this._scaledCellHeight,i*this._scaledCellWidth,s*this._scaledCellHeight))}_fillCharTrueColor(t,e,i,s){this._ctx.font=this._getFont(t,!1,!1),this._ctx.textBaseline="middle",this._clipRow(t,s),this._ctx.fillText(e.getChars(),i*this._scaledCellWidth+this._scaledCharLeft,s*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight/2)}_clipRow(t,e){this._ctx.beginPath(),this._ctx.rect(0,e*this._scaledCellHeight,t.cols*this._scaledCellWidth,this._scaledCellHeight),this._ctx.clip()}_getFont(t,e,i){return`${i?"italic":""} ${e?t.getOption("fontWeightBold"):t.getOption("fontWeight")} ${t.getOption("fontSize")*window.devicePixelRatio}px ${t.getOption("fontFamily")}`}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(7),r=i(15),o=[];e.acquireCharAtlas=function(t,e,i,n,a){for(var l=s.generateConfig(n,a,t,i),h=0;h<o.length;h++){var c=(_=o[h]).ownedBy.indexOf(e);if(c>=0){if(s.configEquals(_.config,l))return _.atlas;1===_.ownedBy.length?(_.atlas.dispose(),o.splice(h,1)):_.ownedBy.splice(c,1);break}}for(h=0;h<o.length;h++){var _=o[h];if(s.configEquals(_.config,l))return _.ownedBy.push(e),_.atlas}var d={atlas:new r.DynamicCharAtlas(document,l),config:l,ownedBy:[e]};return o.push(d),d.atlas},e.removeTerminalFromCache=function(t){for(var e=0;e<o.length;e++){var i=o[e].ownedBy.indexOf(t);if(-1!==i){1===o[e].ownedBy.length?(o[e].atlas.dispose(),o.splice(e,1)):o[e].ownedBy.splice(i,1);break}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(0);e.generateConfig=function(t,e,i,s){var r={foreground:s.foreground,background:s.background,cursor:void 0,cursorAccent:void 0,selection:void 0,ansi:s.ansi.slice(0,16)};return{devicePixelRatio:window.devicePixelRatio,scaledCharWidth:t,scaledCharHeight:e,fontFamily:i.fontFamily,fontSize:i.fontSize,fontWeight:i.fontWeight,fontWeightBold:i.fontWeightBold,allowTransparency:i.allowTransparency,colors:r}},e.configEquals=function(t,e){for(var i=0;i<t.colors.ansi.length;i++)if(t.colors.ansi[i].rgba!==e.colors.ansi[i].rgba)return!1;return t.devicePixelRatio===e.devicePixelRatio&&t.fontFamily===e.fontFamily&&t.fontSize===e.fontSize&&t.fontWeight===e.fontWeight&&t.fontWeightBold===e.fontWeightBold&&t.allowTransparency===e.allowTransparency&&t.scaledCharWidth===e.scaledCharWidth&&t.scaledCharHeight===e.scaledCharHeight&&t.colors.foreground===e.colors.foreground&&t.colors.background===e.colors.background},e.is256Color=function(t){return t<s.DEFAULT_COLOR}},function(t,e,i){"use strict";var s,r=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(23),n=i(0),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.content=0,e.fg=0,e.bg=0,e.combinedData="",e}return r(e,t),e.fromCharData=function(t){var i=new e;return i.setFromCharData(t),i},e.prototype.isCombined=function(){return 2097152&this.content},e.prototype.getWidth=function(){return this.content>>22},e.prototype.getChars=function(){return 2097152&this.content?this.combinedData:2097151&this.content?o.stringFromCodePoint(2097151&this.content):""},e.prototype.getCode=function(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content},e.prototype.setFromCharData=function(t){this.fg=t[n.CHAR_DATA_ATTR_INDEX],this.bg=0;var e=!1;if(t[n.CHAR_DATA_CHAR_INDEX].length>2)e=!0;else if(2===t[n.CHAR_DATA_CHAR_INDEX].length){var i=t[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=i&&i<=56319){var s=t[n.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(i-55296)+s-56320+65536|t[n.CHAR_DATA_WIDTH_INDEX]<<22:e=!0}else e=!0}else this.content=t[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[n.CHAR_DATA_WIDTH_INDEX]<<22;e&&(this.combinedData=t[n.CHAR_DATA_CHAR_INDEX],this.content=2097152|t[n.CHAR_DATA_WIDTH_INDEX]<<22)},e.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},e}(i(24).AttributeData);e.CellData=a},function(t,e,i){i(10)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});i(11);e.WebglAddon=WebglAddon},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(12),r=i(14),o=i(22),n=i(6),a=i(4),l=i(25),h=i(2),c=i(26),_=i(0),d=i(27),u=i(8);e.WebglRenderer=class extends c.Disposable{constructor(t,e,i){super(),this._terminal=t,this._colors=e,this._model=new h.RenderModel,this._workCell=new u.CellData,this._onRequestRefreshRows=new d.EventEmitter,this._core=this._terminal._core,this._renderLayers=[new r.LinkRenderLayer(this._core.screenElement,2,this._colors,this._core),new o.CursorRenderLayer(this._core.screenElement,3,this._colors,this._onRequestRefreshRows)],this.dimensions={scaledCharWidth:0,scaledCharHeight:0,scaledCellWidth:0,scaledCellHeight:0,scaledCharLeft:0,scaledCharTop:0,scaledCanvasWidth:0,scaledCanvasHeight:0,canvasWidth:0,canvasHeight:0,actualCellWidth:0,actualCellHeight:0},this._devicePixelRatio=window.devicePixelRatio,this._updateDimensions(),this._canvas=document.createElement("canvas");const n={antialias:!1,depth:!1,preserveDrawingBuffer:i};if(this._gl=this._canvas.getContext("webgl2",n),!this._gl)throw new Error("WebGL2 not supported");this._core.screenElement.appendChild(this._canvas),this._rectangleRenderer=new l.RectangleRenderer(this._terminal,this._colors,this._gl,this.dimensions),this._glyphRenderer=new s.GlyphRenderer(this._terminal,this._colors,this._gl,this.dimensions),this.onCharSizeChanged()}get onRequestRefreshRows(){return this._onRequestRefreshRows.event}dispose(){this._renderLayers.forEach(t=>t.dispose()),this._core.screenElement.removeChild(this._canvas),super.dispose()}setColors(t){this._colors=t,this._renderLayers.forEach(t=>{t.setColors(this._terminal,this._colors),t.reset(this._terminal)}),this._rectangleRenderer.setColors(),this._glyphRenderer.setColors(),this._refreshCharAtlas(),this._model.clear()}onDevicePixelRatioChange(){this._devicePixelRatio!==window.devicePixelRatio&&(this._devicePixelRatio=window.devicePixelRatio,this.onResize(this._terminal.cols,this._terminal.rows))}onResize(t,e){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows),this._rectangleRenderer.onResize(),this._renderLayers.forEach(t=>t.resize(this._terminal,this.dimensions)),this._canvas.width=this.dimensions.scaledCanvasWidth,this._canvas.height=this.dimensions.scaledCanvasHeight,this._canvas.style.width=`${this.dimensions.canvasWidth}px`,this._canvas.style.height=`${this.dimensions.canvasHeight}px`,this._core.screenElement.style.width=`${this.dimensions.canvasWidth}px`,this._core.screenElement.style.height=`${this.dimensions.canvasHeight}px`,this._glyphRenderer.setDimensions(this.dimensions),this._glyphRenderer.onResize(),this._refreshCharAtlas(),this._model.clear()}onCharSizeChanged(){this.onResize(this._terminal.cols,this._terminal.rows)}onBlur(){this._renderLayers.forEach(t=>t.onBlur(this._terminal))}onFocus(){this._renderLayers.forEach(t=>t.onFocus(this._terminal))}onSelectionChanged(t,e,i){this._renderLayers.forEach(s=>s.onSelectionChanged(this._terminal,t,e,i)),this._updateSelectionModel(t,e),this._rectangleRenderer.updateSelection(this._model.selection,i),this._glyphRenderer.updateSelection(this._model,i),this._onRequestRefreshRows.fire({start:0,end:this._terminal.rows-1})}onCursorMove(){this._renderLayers.forEach(t=>t.onCursorMove(this._terminal))}onOptionsChanged(){this._renderLayers.forEach(t=>t.onOptionsChanged(this._terminal)),this._updateDimensions(),this._refreshCharAtlas()}_refreshCharAtlas(){if(this.dimensions.scaledCharWidth<=0&&this.dimensions.scaledCharHeight<=0)return;const t=n.acquireCharAtlas(this._terminal,this._colors,this.dimensions.scaledCharWidth,this.dimensions.scaledCharHeight);if(!("getRasterizedGlyph"in t))throw new Error("The webgl renderer only works with the webgl char atlas");this._charAtlas=t,this._charAtlas.warmUp(),this._glyphRenderer.setAtlas(this._charAtlas)}clear(){this._renderLayers.forEach(t=>t.reset(this._terminal))}registerCharacterJoiner(t){return-1}deregisterCharacterJoiner(t){return!1}renderRows(t,e){this._renderLayers.forEach(i=>i.onGridChanged(this._terminal,t,e)),this._glyphRenderer.beginFrame()&&this._model.clear(),this._updateModel(t,e),this._rectangleRenderer.render(),this._glyphRenderer.render(this._model,this._model.selection.hasSelection)}_updateModel(t,e){const i=this._core;for(let s=t;s<=e;s++){const t=s+i.buffer.ydisp,e=i.buffer.lines.get(t);this._model.lineLengths[s]=0;for(let t=0;t<i.cols;t++){e.loadCell(t,this._workCell);const r=this._workCell.getChars();let o=this._workCell.getCode();const n=(s*i.cols+t)*h.RENDER_MODEL_INDICIES_PER_CELL;o!==_.NULL_CELL_CODE&&(this._model.lineLengths[s]=t+1);let l=this._workCell.bg,c=this._workCell.fg;if(this._model.cells[n]!==o||this._model.cells[n+h.RENDER_MODEL_BG_OFFSET]!==l||this._model.cells[n+h.RENDER_MODEL_FG_OFFSET]!==c){if(this._workCell.isInverse()){const t=l;l=c,(c=t)===_.DEFAULT_COLOR&&(c=a.INVERTED_DEFAULT_COLOR),l===_.DEFAULT_COLOR&&(l=a.INVERTED_DEFAULT_COLOR)}i.options.drawBoldTextInBrightColors&&this._workCell.isBold()&&134217728&c&&this._workCell.getFgColor()<8&&(c+=8),r.length>1&&(o|=h.COMBINED_CHAR_BIT_MASK),this._model.cells[n]=o,this._model.cells[n+h.RENDER_MODEL_BG_OFFSET]=l,this._model.cells[n+h.RENDER_MODEL_FG_OFFSET]=c,this._glyphRenderer.updateCell(t,s,o,l,c,r)}}}this._rectangleRenderer.updateBackgrounds(this._model)}_updateSelectionModel(t,e){const i=this._terminal;if(!t||!e||t[0]===e[0]&&t[1]===e[1])return void this._model.clearSelection();const s=t[1]-i.buffer.viewportY,r=e[1]-i.buffer.viewportY,o=Math.max(s,0),n=Math.min(r,i.rows-1);o>=i.rows||n<0?this._model.clearSelection():(this._model.selection.hasSelection=!0,this._model.selection.viewportStartRow=s,this._model.selection.viewportEndRow=r,this._model.selection.viewportCappedStartRow=o,this._model.selection.viewportCappedEndRow=n,this._model.selection.startCol=t[0],this._model.selection.endCol=e[0])}_updateDimensions(){this._core._charSizeService.width&&this._core._charSizeService.height&&(this.dimensions.scaledCharWidth=Math.floor(this._core._charSizeService.width*this._devicePixelRatio),this.dimensions.scaledCharHeight=Math.ceil(this._core._charSizeService.height*this._devicePixelRatio),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._terminal.getOption("lineHeight")),this.dimensions.scaledCharTop=1===this._terminal.getOption("lineHeight")?0:Math.round((this.dimensions.scaledCellHeight-this.dimensions.scaledCharHeight)/2),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._terminal.getOption("letterSpacing")),this.dimensions.scaledCharLeft=Math.floor(this._terminal.getOption("letterSpacing")/2),this.dimensions.scaledCanvasHeight=this._terminal.rows*this.dimensions.scaledCellHeight,this.dimensions.scaledCanvasWidth=this._terminal.cols*this.dimensions.scaledCellWidth,this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/this._devicePixelRatio),this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/this._devicePixelRatio),this.dimensions.actualCellHeight=this.dimensions.scaledCellHeight/this._devicePixelRatio,this.dimensions.actualCellWidth=this.dimensions.scaledCellWidth/this._devicePixelRatio)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),r=i(2),o=i(3),n=i(13),a=i(0),l="#version 300 es\nlayout (location = 0) in vec2 a_unitquad;\nlayout (location = 1) in vec2 a_cellpos;\nlayout (location = 2) in vec2 a_offset;\nlayout (location = 3) in vec2 a_size;\nlayout (location = 4) in vec2 a_texcoord;\nlayout (location = 5) in vec2 a_texsize;\n\nuniform mat4 u_projection;\nuniform vec2 u_resolution;\n\nout vec2 v_texcoord;\n\nvoid main() {\n  vec2 zeroToOne = (a_offset / u_resolution) + a_cellpos + (a_unitquad * a_size);\n  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);\n  v_texcoord = a_texcoord + a_unitquad * a_texsize;\n}",h="#version 300 es\nprecision lowp float;\n\nin vec2 v_texcoord;\n\nuniform sampler2D u_texture;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = texture(u_texture, v_texcoord);\n}",c=10,_=c*Float32Array.BYTES_PER_ELEMENT,d=2;e.GlyphRenderer=class{constructor(t,e,i,r){this._terminal=t,this._colors=e,this._gl=i,this._dimensions=r,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),attributesBuffers:[new Float32Array(0),new Float32Array(0)],selectionAttributes:new Float32Array(0)};const o=this._gl,n=s.throwIfFalsy(s.createProgram(o,l,h));this._program=n,this._projectionLocation=s.throwIfFalsy(o.getUniformLocation(this._program,"u_projection")),this._resolutionLocation=s.throwIfFalsy(o.getUniformLocation(this._program,"u_resolution")),this._textureLocation=s.throwIfFalsy(o.getUniformLocation(this._program,"u_texture")),this._vertexArrayObject=o.createVertexArray(),o.bindVertexArray(this._vertexArrayObject);const a=new Float32Array([0,0,1,0,0,1,1,1]),c=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,c),o.bufferData(o.ARRAY_BUFFER,a,o.STATIC_DRAW),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,2,this._gl.FLOAT,!1,0,0);const d=new Uint8Array([0,1,3,0,2,3]),u=o.createBuffer();o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,u),o.bufferData(o.ELEMENT_ARRAY_BUFFER,d,o.STATIC_DRAW),this._attributesBuffer=s.throwIfFalsy(o.createBuffer()),o.bindBuffer(o.ARRAY_BUFFER,this._attributesBuffer),o.enableVertexAttribArray(2),o.vertexAttribPointer(2,2,o.FLOAT,!1,_,0),o.vertexAttribDivisor(2,1),o.enableVertexAttribArray(3),o.vertexAttribPointer(3,2,o.FLOAT,!1,_,2*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribDivisor(3,1),o.enableVertexAttribArray(4),o.vertexAttribPointer(4,2,o.FLOAT,!1,_,4*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribDivisor(4,1),o.enableVertexAttribArray(5),o.vertexAttribPointer(5,2,o.FLOAT,!1,_,6*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribDivisor(5,1),o.enableVertexAttribArray(1),o.vertexAttribPointer(1,2,o.FLOAT,!1,_,8*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribDivisor(1,1),this._atlasTexture=s.throwIfFalsy(o.createTexture()),o.bindTexture(o.TEXTURE_2D,this._atlasTexture),o.texImage2D(o.TEXTURE_2D,0,o.RGBA,1,1,0,o.RGBA,o.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),this.onResize()}beginFrame(){return!this._atlas||this._atlas.beginFrame()}updateCell(t,e,i,s,r,o){this._updateCell(this._vertices.attributes,t,e,i,s,r,o)}_updateCell(t,e,i,s,r,n,l){const h=(i*this._terminal.cols+e)*c;if(s===a.NULL_CELL_CODE||s===a.WHITESPACE_CELL_CODE||void 0===s)return void o.fill(t,0,h,h+c-1-d);let _;if(!this._atlas)throw new Error("atlas must be set before updating cell");(_=l&&l.length>1?this._atlas.getRasterizedGlyphCombinedChar(l,r,n):this._atlas.getRasterizedGlyph(s,r,n))?(t[h]=-_.offset.x+this._dimensions.scaledCharLeft,t[h+1]=-_.offset.y+this._dimensions.scaledCharTop,t[h+2]=_.size.x/this._dimensions.scaledCanvasWidth,t[h+3]=_.size.y/this._dimensions.scaledCanvasHeight,t[h+4]=_.texturePositionClipSpace.x,t[h+5]=_.texturePositionClipSpace.y,t[h+6]=_.sizeClipSpace.x,t[h+7]=_.sizeClipSpace.y):o.fill(t,0,h,h+c-1-d)}updateSelection(t,e){const i=this._terminal;this._vertices.selectionAttributes=n.slice(this._vertices.attributes,0);const s=this._colors.selectionOpaque.rgba>>>8|50331648;if(e){const e=t.selection.startCol,i=t.selection.endCol-e,r=t.selection.viewportCappedEndRow-t.selection.viewportCappedStartRow+1;for(let o=t.selection.viewportCappedStartRow;o<t.selection.viewportCappedStartRow+r;o++)this._updateSelectionRange(e,e+i,o,t,s)}else{const e=t.selection.viewportStartRow===t.selection.viewportCappedStartRow?t.selection.startCol:0,r=t.selection.viewportCappedStartRow===t.selection.viewportCappedEndRow?t.selection.endCol:i.cols;this._updateSelectionRange(e,r,t.selection.viewportCappedStartRow,t,s);const o=Math.max(t.selection.viewportCappedEndRow-t.selection.viewportCappedStartRow-1,0);for(let e=t.selection.viewportCappedStartRow+1;e<=t.selection.viewportCappedStartRow+o;e++)this._updateSelectionRange(0,r,e,t,s);if(t.selection.viewportCappedStartRow!==t.selection.viewportCappedEndRow){const e=t.selection.viewportEndRow===t.selection.viewportCappedEndRow?t.selection.endCol:i.cols;this._updateSelectionRange(0,e,t.selection.viewportCappedEndRow,t,s)}}}_updateSelectionRange(t,e,i,s,o){const n=this._terminal,a=i+n.buffer.viewportY;let l;for(let h=t;h<e;h++){const t=(i*this._terminal.cols+h)*r.RENDER_MODEL_INDICIES_PER_CELL;if(s.cells[t]&r.COMBINED_CHAR_BIT_MASK){l||(l=n.buffer.getLine(a));const e=l.getCell(h).char;this._updateCell(this._vertices.selectionAttributes,h,i,s.cells[t],o,s.cells[t+r.RENDER_MODEL_FG_OFFSET],e)}else this._updateCell(this._vertices.selectionAttributes,h,i,s.cells[t],o,s.cells[t+r.RENDER_MODEL_FG_OFFSET])}}onResize(){const t=this._terminal,e=this._gl;e.viewport(0,0,e.canvas.width,e.canvas.height);const i=t.cols*t.rows*c;if(this._vertices.count!==i){this._vertices.count=i,this._vertices.attributes=new Float32Array(i);for(let t=0;t<this._vertices.attributesBuffers.length;t++)this._vertices.attributesBuffers[t]=new Float32Array(i);let e=0;for(let i=0;i<t.rows;i++)for(let s=0;s<t.cols;s++)this._vertices.attributes[e+8]=s/t.cols,this._vertices.attributes[e+9]=i/t.rows,e+=c}}setColors(){}render(t,e){if(!this._atlas)return;const i=this._gl;i.useProgram(this._program),i.bindVertexArray(this._vertexArrayObject),this._activeBuffer=(this._activeBuffer+1)%2;const r=this._vertices.attributesBuffers[this._activeBuffer];let o=0;for(let i=0;i<t.lineLengths.length;i++){const s=i*this._terminal.cols*c,n=(e?this._vertices.selectionAttributes:this._vertices.attributes).subarray(s,s+t.lineLengths[i]*c);r.set(n,o),o+=n.length}i.bindBuffer(i.ARRAY_BUFFER,this._attributesBuffer),i.bufferData(i.ARRAY_BUFFER,r.subarray(0,o),i.STREAM_DRAW),this._atlas.hasCanvasChanged&&(this._atlas.hasCanvasChanged=!1,i.uniform1i(this._textureLocation,0),i.activeTexture(i.TEXTURE0+0),i.bindTexture(i.TEXTURE_2D,this._atlasTexture),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,this._atlas.cacheCanvas),i.generateMipmap(i.TEXTURE_2D)),i.uniformMatrix4fv(this._projectionLocation,!1,s.PROJECTION_MATRIX),i.uniform2f(this._resolutionLocation,i.canvas.width,i.canvas.height),i.drawElementsInstanced(i.TRIANGLES,6,i.UNSIGNED_BYTE,0,o/c)}setAtlas(t){const e=this._gl;this._atlas=t,e.bindTexture(e.TEXTURE_2D,this._atlasTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.cacheCanvas),e.generateMipmap(e.TEXTURE_2D)}setDimensions(t){this._dimensions=t}}},function(t,e,i){"use strict";function s(t,e=0,i=t.length){e<0&&(e=(t.length+e)%t.length),i=i>=t.length?t.length:(t.length+i)%t.length,e=Math.min(e,i);const s=new t.constructor(i-e);for(let r=0;r<i-e;++r)s[r]=t[r+e];return s}Object.defineProperty(e,"__esModule",{value:!0}),e.slice=function(t,e,i){return t.slice?t.slice(e,i):s(t,e,i)},e.sliceFallback=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5),r=i(4),o=i(7);e.LinkRenderLayer=class extends s.BaseRenderLayer{constructor(t,e,i,s){super(t,"link",e,!0,i),s.linkifier.onLinkHover(t=>this._onLinkHover(t)),s.linkifier.onLinkLeave(t=>this._onLinkLeave(t))}resize(t,e){super.resize(t,e),this._state=void 0}reset(t){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);const t=this._state.y2-this._state.y1-1;t>0&&this._clearCells(0,this._state.y1+1,this._state.cols,t),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_onLinkHover(t){if(t.fg===r.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._colors.background.css:void 0!==t.fg&&o.is256Color(t.fg)?this._ctx.fillStyle=this._colors.ansi[t.fg].css:this._ctx.fillStyle=this._colors.foreground.css,t.y1===t.y2)this._fillBottomLineAtCells(t.x1,t.y1,t.x2-t.x1);else{this._fillBottomLineAtCells(t.x1,t.y1,t.cols-t.x1);for(let e=t.y1+1;e<t.y2;e++)this._fillBottomLineAtCells(0,e,t.cols);this._fillBottomLineAtCells(0,t.y2,t.x2)}this._state=t}_onLinkLeave(t){this._clearCurrentLink()}}},function(t,e,i){"use strict";var s,r=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0});var o=i(4),n=i(16),a=i(17),l=i(19),h=i(20),c=i(21),_=1024,d=1024,u={css:"rgba(0, 0, 0, 0)",rgba:0};function f(t){return t.code<<21|t.bg<<12|t.fg<<3|(t.bold?0:4)+(t.dim?0:2)+(t.italic?0:1)}e.getGlyphCacheKey=f;var p=function(t){function e(e,i){var s=t.call(this)||this;s._config=i,s._drawToCacheCount=0,s._glyphsWaitingOnBitmap=[],s._bitmapCommitTimeout=null,s._bitmap=null,s._cacheCanvas=e.createElement("canvas"),s._cacheCanvas.width=_,s._cacheCanvas.height=d,s._cacheCtx=c.throwIfFalsy(s._cacheCanvas.getContext("2d",{alpha:!0}));var r=e.createElement("canvas");r.width=s._config.scaledCharWidth,r.height=s._config.scaledCharHeight,s._tmpCtx=c.throwIfFalsy(r.getContext("2d",{alpha:s._config.allowTransparency})),s._width=Math.floor(_/s._config.scaledCharWidth),s._height=Math.floor(d/s._config.scaledCharHeight);var o=s._width*s._height;return s._cacheMap=new l.LRUMap(o),s._cacheMap.prealloc(o),s}return r(e,t),e.prototype.dispose=function(){null!==this._bitmapCommitTimeout&&(window.clearTimeout(this._bitmapCommitTimeout),this._bitmapCommitTimeout=null)},e.prototype.beginFrame=function(){this._drawToCacheCount=0},e.prototype.draw=function(t,e,i,s){if(32===e.code)return!0;if(!this._canCache(e))return!1;var r=f(e),o=this._cacheMap.get(r);if(null!=o)return this._drawFromCache(t,o,i,s),!0;if(this._drawToCacheCount<100){var n=void 0;n=this._cacheMap.size<this._cacheMap.capacity?this._cacheMap.size:this._cacheMap.peek().index;var a=this._drawToCache(e,n);return this._cacheMap.set(r,a),this._drawFromCache(t,a,i,s),!0}return!1},e.prototype._canCache=function(t){return t.code<256},e.prototype._toCoordinateX=function(t){return t%this._width*this._config.scaledCharWidth},e.prototype._toCoordinateY=function(t){return Math.floor(t/this._width)*this._config.scaledCharHeight},e.prototype._drawFromCache=function(t,e,i,s){if(!e.isEmpty){var r=this._toCoordinateX(e.index),o=this._toCoordinateY(e.index);t.drawImage(e.inBitmap?this._bitmap:this._cacheCanvas,r,o,this._config.scaledCharWidth,this._config.scaledCharHeight,i,s,this._config.scaledCharWidth,this._config.scaledCharHeight)}},e.prototype._getColorFromAnsiIndex=function(t){return t<this._config.colors.ansi.length?this._config.colors.ansi[t]:a.DEFAULT_ANSI_COLORS[t]},e.prototype._getBackgroundColor=function(t){return this._config.allowTransparency?u:t.bg===o.INVERTED_DEFAULT_COLOR?this._config.colors.foreground:t.bg<256?this._getColorFromAnsiIndex(t.bg):this._config.colors.background},e.prototype._getForegroundColor=function(t){return t.fg===o.INVERTED_DEFAULT_COLOR?this._config.colors.background:t.fg<256?this._getColorFromAnsiIndex(t.fg):this._config.colors.foreground},e.prototype._drawToCache=function(t,e){this._drawToCacheCount++,this._tmpCtx.save();var i=this._getBackgroundColor(t);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=i.css,this._tmpCtx.fillRect(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),this._tmpCtx.globalCompositeOperation="source-over";var s=t.bold?this._config.fontWeightBold:this._config.fontWeight,r=t.italic?"italic":"";this._tmpCtx.font=r+" "+s+" "+this._config.fontSize*this._config.devicePixelRatio+"px "+this._config.fontFamily,this._tmpCtx.textBaseline="middle",this._tmpCtx.fillStyle=this._getForegroundColor(t).css,t.dim&&(this._tmpCtx.globalAlpha=o.DIM_OPACITY),this._tmpCtx.fillText(t.chars,0,this._config.scaledCharHeight/2),this._tmpCtx.restore();var n=this._tmpCtx.getImageData(0,0,this._config.scaledCharWidth,this._config.scaledCharHeight),a=!1;this._config.allowTransparency||(a=function(t,e){for(var i=!0,s=e.rgba>>>24,r=e.rgba>>>16&255,o=e.rgba>>>8&255,n=0;n<t.data.length;n+=4)t.data[n]===s&&t.data[n+1]===r&&t.data[n+2]===o?t.data[n+3]=0:i=!1;return i}(n,i));var l=this._toCoordinateX(e),h=this._toCoordinateY(e);this._cacheCtx.putImageData(n,l,h);var c={index:e,isEmpty:a,inBitmap:!1};return this._addGlyphToBitmap(c),c},e.prototype._addGlyphToBitmap=function(t){var e=this;"createImageBitmap"in window&&!h.isFirefox&&!h.isSafari&&(this._glyphsWaitingOnBitmap.push(t),null===this._bitmapCommitTimeout&&(this._bitmapCommitTimeout=window.setTimeout(function(){return e._generateBitmap()},100)))},e.prototype._generateBitmap=function(){var t=this,e=this._glyphsWaitingOnBitmap;this._glyphsWaitingOnBitmap=[],window.createImageBitmap(this._cacheCanvas).then(function(i){t._bitmap=i;for(var s=0;s<e.length;s++){e[s].inBitmap=!0}}),this._bitmapCommitTimeout=null},e}(n.BaseCharAtlas);e.DynamicCharAtlas=p;var C=function(t){function e(e,i){return t.call(this)||this}return r(e,t),e.prototype.draw=function(t,e,i,s){return!1},e}(n.BaseCharAtlas);e.NoneCharAtlas=C},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._didWarmUp=!1}return t.prototype.dispose=function(){},t.prototype.warmUp=function(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)},t.prototype._doWarmUp=function(){},t.prototype.beginFrame=function(){},t}();e.BaseCharAtlas=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i(18),r=s.fromCss("#ffffff"),o=s.fromCss("#000000"),n=s.fromCss("#ffffff"),a=s.fromCss("#000000"),l={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};e.DEFAULT_ANSI_COLORS=function(){for(var t=[s.fromCss("#2e3436"),s.fromCss("#cc0000"),s.fromCss("#4e9a06"),s.fromCss("#c4a000"),s.fromCss("#3465a4"),s.fromCss("#75507b"),s.fromCss("#06989a"),s.fromCss("#d3d7cf"),s.fromCss("#555753"),s.fromCss("#ef2929"),s.fromCss("#8ae234"),s.fromCss("#fce94f"),s.fromCss("#729fcf"),s.fromCss("#ad7fa8"),s.fromCss("#34e2e2"),s.fromCss("#eeeeec")],e=[0,95,135,175,215,255],i=0;i<216;i++){var r=e[i/36%6|0],o=e[i/6%6|0],n=e[i%6];t.push({css:s.toCss(r,o,n),rgba:s.toRgba(r,o,n)})}for(i=0;i<24;i++){var a=8+10*i;t.push({css:s.toCss(a,a,a),rgba:s.toRgba(a,a,a)})}return t}();var h=function(){function t(t,i){this.allowTransparency=i;var h=t.createElement("canvas");h.width=1,h.height=1;var c=h.getContext("2d");if(!c)throw new Error("Could not get rendering context");this._ctx=c,this._ctx.globalCompositeOperation="copy",this._litmusColor=this._ctx.createLinearGradient(0,0,1,1),this.colors={foreground:r,background:o,cursor:n,cursorAccent:a,selection:l,selectionOpaque:s.blend(o,l),ansi:e.DEFAULT_ANSI_COLORS.slice()}}return t.prototype.setTheme=function(t){void 0===t&&(t={}),this.colors.foreground=this._parseColor(t.foreground,r),this.colors.background=this._parseColor(t.background,o),this.colors.cursor=this._parseColor(t.cursor,n,!0),this.colors.cursorAccent=this._parseColor(t.cursorAccent,a,!0),this.colors.selection=this._parseColor(t.selection,l,!0),this.colors.selectionOpaque=s.blend(this.colors.background,this.colors.selection),this.colors.ansi[0]=this._parseColor(t.black,e.DEFAULT_ANSI_COLORS[0]),this.colors.ansi[1]=this._parseColor(t.red,e.DEFAULT_ANSI_COLORS[1]),this.colors.ansi[2]=this._parseColor(t.green,e.DEFAULT_ANSI_COLORS[2]),this.colors.ansi[3]=this._parseColor(t.yellow,e.DEFAULT_ANSI_COLORS[3]),this.colors.ansi[4]=this._parseColor(t.blue,e.DEFAULT_ANSI_COLORS[4]),this.colors.ansi[5]=this._parseColor(t.magenta,e.DEFAULT_ANSI_COLORS[5]),this.colors.ansi[6]=this._parseColor(t.cyan,e.DEFAULT_ANSI_COLORS[6]),this.colors.ansi[7]=this._parseColor(t.white,e.DEFAULT_ANSI_COLORS[7]),this.colors.ansi[8]=this._parseColor(t.brightBlack,e.DEFAULT_ANSI_COLORS[8]),this.colors.ansi[9]=this._parseColor(t.brightRed,e.DEFAULT_ANSI_COLORS[9]),this.colors.ansi[10]=this._parseColor(t.brightGreen,e.DEFAULT_ANSI_COLORS[10]),this.colors.ansi[11]=this._parseColor(t.brightYellow,e.DEFAULT_ANSI_COLORS[11]),this.colors.ansi[12]=this._parseColor(t.brightBlue,e.DEFAULT_ANSI_COLORS[12]),this.colors.ansi[13]=this._parseColor(t.brightMagenta,e.DEFAULT_ANSI_COLORS[13]),this.colors.ansi[14]=this._parseColor(t.brightCyan,e.DEFAULT_ANSI_COLORS[14]),this.colors.ansi[15]=this._parseColor(t.brightWhite,e.DEFAULT_ANSI_COLORS[15])},t.prototype._parseColor=function(t,e,i){if(void 0===i&&(i=this.allowTransparency),void 0===t)return e;if(this._ctx.fillStyle=this._litmusColor,this._ctx.fillStyle=t,"string"!=typeof this._ctx.fillStyle)return console.warn("Color: "+t+" is invalid using fallback "+e.css),e;this._ctx.fillRect(0,0,1,1);var r=this._ctx.getImageData(0,0,1,1).data;return i||255===r[3]?{css:t,rgba:s.toRgba(r[0],r[1],r[2],r[3])}:(console.warn("Color: "+t+" is using transparency, but allowTransparency is false. Using fallback "+e.css+"."),e)},t}();e.ColorManager=h},function(t,e,i){"use strict";function s(t){var e=t.toString(16);return e.length<2?"0"+e:e}function r(t,e,i){return"#"+s(t)+s(e)+s(i)}function o(t,e,i,s){return void 0===s&&(s=255),(t<<24|e<<16|i<<8|s)>>>0}Object.defineProperty(e,"__esModule",{value:!0}),e.blend=function(t,e){var i=(255&e.rgba)/255;if(1===i)return{css:e.css,rgba:e.rgba};var s=e.rgba>>24&255,n=e.rgba>>16&255,a=e.rgba>>8&255,l=t.rgba>>24&255,h=t.rgba>>16&255,c=t.rgba>>8&255,_=l+Math.round((s-l)*i),d=h+Math.round((n-h)*i),u=c+Math.round((a-c)*i);return{css:r(_,d,u),rgba:o(_,d,u)}},e.fromCss=function(t){return{css:t,rgba:(parseInt(t.slice(1),16)<<8|255)>>>0}},e.toPaddedHex=s,e.toCss=r,e.toRgba=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t){this.capacity=t,this._map={},this._head=null,this._tail=null,this._nodePool=[],this.size=0}return t.prototype._unlinkNode=function(t){var e=t.prev,i=t.next;t===this._head&&(this._head=i),t===this._tail&&(this._tail=e),null!==e&&(e.next=i),null!==i&&(i.prev=e)},t.prototype._appendNode=function(t){var e=this._tail;null!==e&&(e.next=t),t.prev=e,t.next=null,this._tail=t,null===this._head&&(this._head=t)},t.prototype.prealloc=function(t){for(var e=this._nodePool,i=0;i<t;i++)e.push({prev:null,next:null,key:null,value:null})},t.prototype.get=function(t){var e=this._map[t];return void 0!==e?(this._unlinkNode(e),this._appendNode(e),e.value):null},t.prototype.peekValue=function(t){var e=this._map[t];return void 0!==e?e.value:null},t.prototype.peek=function(){var t=this._head;return null===t?null:t.value},t.prototype.set=function(t,e){var i=this._map[t];if(void 0!==i)i=this._map[t],this._unlinkNode(i),i.value=e;else if(this.size>=this.capacity)i=this._head,this._unlinkNode(i),delete this._map[i.key],i.key=t,i.value=e,this._map[t]=i;else{var s=this._nodePool;s.length>0?((i=s.pop()).key=t,i.value=e):i={prev:null,next:null,key:t,value:e},this._map[t]=i,this.size++}this._appendNode(i)},t}();e.LRUMap=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s="undefined"==typeof navigator,r=s?"node":navigator.userAgent,o=s?"node":navigator.platform;function n(t,e){return t.indexOf(e)>=0}e.isFirefox=!!~r.indexOf("Firefox"),e.isSafari=/^((?!chrome|android).)*safari/i.test(r),e.isMac=n(["Macintosh","MacIntel","MacPPC","Mac68K"],o),e.isIpad="iPad"===o,e.isIphone="iPhone"===o,e.isWindows=n(["Windows","Win16","Win32","WinCE"],o),e.isLinux=o.indexOf("Linux")>=0},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.throwIfFalsy=function(t){if(!t)throw new Error("value must not be falsy");return t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5),r=i(8),o=600;e.CursorRenderLayer=class extends s.BaseRenderLayer{constructor(t,e,i,s){super(t,"cursor",e,!0,i),this._onRequestRefreshRowsEvent=s,this._cell=new r.CellData,this._state={x:0,y:0,isFocused:!1,style:"",width:0},this._cursorRenderers={bar:this._renderBarCursor.bind(this),block:this._renderBlockCursor.bind(this),underline:this._renderUnderlineCursor.bind(this)}}resize(t,e){super.resize(t,e),this._state={x:0,y:0,isFocused:!1,style:"",width:0}}reset(t){this._clearCursor(),this._cursorBlinkStateManager&&(this._cursorBlinkStateManager.dispose(),this.onOptionsChanged(t))}onBlur(t){this._cursorBlinkStateManager&&this._cursorBlinkStateManager.pause(),this._onRequestRefreshRowsEvent.fire({start:t.buffer.cursorY,end:t.buffer.cursorY})}onFocus(t){this._cursorBlinkStateManager?this._cursorBlinkStateManager.resume(t):this._onRequestRefreshRowsEvent.fire({start:t.buffer.cursorY,end:t.buffer.cursorY})}onOptionsChanged(t){var e;t.getOption("cursorBlink")?this._cursorBlinkStateManager||(this._cursorBlinkStateManager=new n(t,()=>{this._render(t,!0)})):(null===(e=this._cursorBlinkStateManager)||void 0===e||e.dispose(),this._cursorBlinkStateManager=void 0),this._onRequestRefreshRowsEvent.fire({start:t.buffer.cursorY,end:t.buffer.cursorY})}onCursorMove(t){this._cursorBlinkStateManager&&this._cursorBlinkStateManager.restartBlinkAnimation(t)}onGridChanged(t,e,i){!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isPaused?this._render(t,!1):this._cursorBlinkStateManager.restartBlinkAnimation(t)}_render(t,e){if(!t._core._coreService.isCursorInitialized||t._core._coreService.isCursorHidden)return void this._clearCursor();const i=t.buffer.baseY+t.buffer.cursorY,s=i-t.buffer.viewportY;if(s<0||s>=t.rows)this._clearCursor();else if(t._core.buffer.lines.get(i).loadCell(t.buffer.cursorX,this._cell),void 0!==this._cell.content){if(!a(t)){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css;const e=t.getOption("cursorStyle");return e&&"block"!==e?this._cursorRenderers[e](t,t.buffer.cursorX,s,this._cell):this._renderBlurCursor(t,t.buffer.cursorX,s,this._cell),this._ctx.restore(),this._state.x=t.buffer.cursorX,this._state.y=s,this._state.isFocused=!1,this._state.style=e,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isCursorVisible){if(this._state){if(this._state.x===t.buffer.cursorX&&this._state.y===s&&this._state.isFocused===a(t)&&this._state.style===t.getOption("cursorStyle")&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[t.getOption("cursorStyle")||"block"](t,t.buffer.cursorX,s,this._cell),this._ctx.restore(),this._state.x=t.buffer.cursorX,this._state.y=s,this._state.isFocused=!1,this._state.style=t.getOption("cursorStyle"),this._state.width=this._cell.getWidth()}else this._clearCursor()}}_clearCursor(){this._state&&(this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})}_renderBarCursor(t,e,i,s){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillLeftLineAtCell(e,i),this._ctx.restore()}_renderBlockCursor(t,e,i,s){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillCells(e,i,s.getWidth(),1),this._ctx.fillStyle=this._colors.cursorAccent.css,this._fillCharTrueColor(t,s,e,i),this._ctx.restore()}_renderUnderlineCursor(t,e,i,s){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillBottomLineAtCells(e,i),this._ctx.restore()}_renderBlurCursor(t,e,i,s){this._ctx.save(),this._ctx.strokeStyle=this._colors.cursor.css,this._strokeRectAtCell(e,i,s.getWidth(),1),this._ctx.restore()}};class n{constructor(t,e){this._renderCallback=e,this.isCursorVisible=!0,a(t)&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(t){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(t=o){this._blinkInterval&&window.clearInterval(this._blinkInterval),this._blinkStartTimeout=setTimeout(()=>{if(this._animationTimeRestarted){const t=o-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,t>0)return void this._restartInterval(t)}this.isCursorVisible=!1,this._animationFrame=window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=setInterval(()=>{if(this._animationTimeRestarted){const t=o-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(t)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},o)},t)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(t){this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation(t)}}function a(t){return document.activeElement===t.textarea&&document.hasFocus()}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.stringFromCodePoint=function(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):String.fromCharCode(t)},e.utf32ToString=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=t.length);for(var s="",r=e;r<i;++r){var o=t[r];o>65535?(o-=65536,s+=String.fromCharCode(55296+(o>>10))+String.fromCharCode(o%1024+56320)):s+=String.fromCharCode(o)}return s};var s=function(){function t(){this._interim=0}return t.prototype.clear=function(){this._interim=0},t.prototype.decode=function(t,e){var i=t.length;if(!i)return 0;var s=0,r=0;this._interim&&(56320<=(a=t.charCodeAt(r++))&&a<=57343?e[s++]=1024*(this._interim-55296)+a-56320+65536:(e[s++]=this._interim,e[s++]=a),this._interim=0);for(var o=r;o<i;++o){var n=t.charCodeAt(o);if(55296<=n&&n<=56319){if(++o>=i)return this._interim=n,s;var a;56320<=(a=t.charCodeAt(o))&&a<=57343?e[s++]=1024*(n-55296)+a-56320+65536:(e[s++]=n,e[s++]=a)}else e[s++]=n}return s},t}();e.StringToUtf32=s;var r=function(){function t(){this.interim=new Uint8Array(3)}return t.prototype.clear=function(){this.interim.fill(0)},t.prototype.decode=function(t,e){var i=t.length;if(!i)return 0;var s,r,o,n,a=0,l=0,h=0;if(this.interim[0]){var c=!1,_=this.interim[0];_&=192==(224&_)?31:224==(240&_)?15:7;for(var d=0,u=void 0;(u=63&this.interim[++d])&&d<4;)_<<=6,_|=u;for(var f=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,p=f-d;h<p;){if(h>=i)return 0;if(128!=(192&(u=t[h++]))){h--,c=!0;break}this.interim[d++]=u,_<<=6,_|=63&u}c||(2===f?_<128?h--:e[a++]=_:3===f?_<2048||_>=55296&&_<=57343||(e[a++]=_):_<65536||_>1114111||(e[a++]=_)),this.interim.fill(0)}for(var C=i-4,g=h;g<i;){for(;!(!(g<C)||128&(s=t[g])||128&(r=t[g+1])||128&(o=t[g+2])||128&(n=t[g+3]));)e[a++]=s,e[a++]=r,e[a++]=o,e[a++]=n,g+=4;if((s=t[g++])<128)e[a++]=s;else if(192==(224&s)){if(g>=i)return this.interim[0]=s,a;if(128!=(192&(r=t[g++]))){g--;continue}if((l=(31&s)<<6|63&r)<128){g--;continue}e[a++]=l}else if(224==(240&s)){if(g>=i)return this.interim[0]=s,a;if(128!=(192&(r=t[g++]))){g--;continue}if(g>=i)return this.interim[0]=s,this.interim[1]=r,a;if(128!=(192&(o=t[g++]))){g--;continue}if((l=(15&s)<<12|(63&r)<<6|63&o)<2048||l>=55296&&l<=57343)continue;e[a++]=l}else if(240==(248&s)){if(g>=i)return this.interim[0]=s,a;if(128!=(192&(r=t[g++]))){g--;continue}if(g>=i)return this.interim[0]=s,this.interim[1]=r,a;if(128!=(192&(o=t[g++]))){g--;continue}if(g>=i)return this.interim[0]=s,this.interim[1]=r,this.interim[2]=o,a;if(128!=(192&(n=t[g++]))){g--;continue}if((l=(7&s)<<18|(63&r)<<12|(63&o)<<6|63&n)<65536||l>1114111)continue;e[a++]=l}}return a},t}();e.Utf8ToUtf32=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this.fg=0,this.bg=0}return t.toColorRGB=function(t){return[t>>>16&255,t>>>8&255,255&t]},t.fromColorRGB=function(t){return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},t.prototype.clone=function(){var e=new t;return e.fg=this.fg,e.bg=this.bg,e},t.prototype.isInverse=function(){return 67108864&this.fg},t.prototype.isBold=function(){return 134217728&this.fg},t.prototype.isUnderline=function(){return 268435456&this.fg},t.prototype.isBlink=function(){return 536870912&this.fg},t.prototype.isInvisible=function(){return 1073741824&this.fg},t.prototype.isItalic=function(){return 67108864&this.bg},t.prototype.isDim=function(){return 134217728&this.bg},t.prototype.getFgColorMode=function(){return 50331648&this.fg},t.prototype.getBgColorMode=function(){return 50331648&this.bg},t.prototype.isFgRGB=function(){return 50331648==(50331648&this.fg)},t.prototype.isBgRGB=function(){return 50331648==(50331648&this.bg)},t.prototype.isFgPalette=function(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)},t.prototype.isBgPalette=function(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)},t.prototype.isFgDefault=function(){return 0==(50331648&this.fg)},t.prototype.isBgDefault=function(){return 0==(50331648&this.bg)},t.prototype.getFgColor=function(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}},t.prototype.getBgColor=function(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}},t}();e.AttributeData=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(1),r=i(3),o=i(2),n="#version 300 es\nlayout (location = 0) in vec2 a_position;\nlayout (location = 1) in vec2 a_size;\nlayout (location = 2) in vec3 a_color;\nlayout (location = 3) in vec2 a_unitquad;\n\nuniform mat4 u_projection;\nuniform vec2 u_resolution;\n\nout vec3 v_color;\n\nvoid main() {\n  vec2 zeroToOne = (a_position + (a_unitquad * a_size)) / u_resolution;\n  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);\n  v_color = a_color;\n}",a="#version 300 es\nprecision lowp float;\n\nin vec3 v_color;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = vec4(v_color, 1);\n}",l=8,h=l*Float32Array.BYTES_PER_ELEMENT,c=20*l;e.RectangleRenderer=class{constructor(t,e,i,r){this._terminal=t,this._colors=e,this._gl=i,this._dimensions=r,this._vertices={count:0,attributes:new Float32Array(c),selection:new Float32Array(3*l)};const o=this._gl;this._program=s.throwIfFalsy(s.createProgram(o,n,a)),this._resolutionLocation=s.throwIfFalsy(o.getUniformLocation(this._program,"u_resolution")),this._projectionLocation=s.throwIfFalsy(o.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=o.createVertexArray(),o.bindVertexArray(this._vertexArrayObject);const _=new Float32Array([0,0,1,0,0,1,1,1]),d=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,d),o.bufferData(o.ARRAY_BUFFER,_,o.STATIC_DRAW),o.enableVertexAttribArray(3),o.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);const u=new Uint8Array([0,1,3,0,2,3]),f=o.createBuffer();o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,f),o.bufferData(o.ELEMENT_ARRAY_BUFFER,u,o.STATIC_DRAW),this._attributesBuffer=s.throwIfFalsy(o.createBuffer()),o.bindBuffer(o.ARRAY_BUFFER,this._attributesBuffer),o.enableVertexAttribArray(0),o.vertexAttribPointer(0,2,o.FLOAT,!1,h,0),o.vertexAttribDivisor(0,1),o.enableVertexAttribArray(1),o.vertexAttribPointer(1,2,o.FLOAT,!1,h,2*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribDivisor(1,1),o.enableVertexAttribArray(2),o.vertexAttribPointer(2,4,o.FLOAT,!1,h,4*Float32Array.BYTES_PER_ELEMENT),o.vertexAttribDivisor(2,1),this._updateCachedColors()}render(){const t=this._gl;t.useProgram(this._program),t.bindVertexArray(this._vertexArrayObject),t.uniformMatrix4fv(this._projectionLocation,!1,s.PROJECTION_MATRIX),t.uniform2f(this._resolutionLocation,t.canvas.width,t.canvas.height),t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,this._vertices.attributes,t.DYNAMIC_DRAW),t.drawElementsInstanced(this._gl.TRIANGLES,6,t.UNSIGNED_BYTE,0,this._vertices.count),t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,this._vertices.selection,t.DYNAMIC_DRAW),t.drawElementsInstanced(this._gl.TRIANGLES,6,t.UNSIGNED_BYTE,0,3)}onResize(){this._updateViewportRectangle()}setColors(){this._updateCachedColors(),this._updateViewportRectangle()}_updateCachedColors(){this._bgFloat=this._colorToFloat32Array(this._colors.background),this._selectionFloat=this._colorToFloat32Array(this._colors.selectionOpaque)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.scaledCellWidth,this._terminal.rows*this._dimensions.scaledCellHeight,this._bgFloat)}updateSelection(t,e){const i=this._terminal;if(t.hasSelection)if(e){const e=t.startCol,i=t.endCol-e,s=t.viewportCappedEndRow-t.viewportCappedStartRow+1;this._addRectangleFloat(this._vertices.selection,0,e*this._dimensions.scaledCellWidth,t.viewportCappedStartRow*this._dimensions.scaledCellHeight,i*this._dimensions.scaledCellWidth,s*this._dimensions.scaledCellHeight,this._selectionFloat),r.fill(this._vertices.selection,0,l)}else{const e=t.viewportStartRow===t.viewportCappedStartRow?t.startCol:0,s=t.viewportCappedStartRow===t.viewportCappedEndRow?t.endCol:i.cols;this._addRectangleFloat(this._vertices.selection,0,e*this._dimensions.scaledCellWidth,t.viewportCappedStartRow*this._dimensions.scaledCellHeight,(s-e)*this._dimensions.scaledCellWidth,this._dimensions.scaledCellHeight,this._selectionFloat);const o=Math.max(t.viewportCappedEndRow-t.viewportCappedStartRow-1,0);if(this._addRectangleFloat(this._vertices.selection,l,0,(t.viewportCappedStartRow+1)*this._dimensions.scaledCellHeight,i.cols*this._dimensions.scaledCellWidth,o*this._dimensions.scaledCellHeight,this._selectionFloat),t.viewportCappedStartRow!==t.viewportCappedEndRow){const e=t.viewportEndRow===t.viewportCappedEndRow?t.endCol:i.cols;this._addRectangleFloat(this._vertices.selection,2*l,0,t.viewportCappedEndRow*this._dimensions.scaledCellHeight,e*this._dimensions.scaledCellWidth,this._dimensions.scaledCellHeight,this._selectionFloat)}else r.fill(this._vertices.selection,0,2*l)}else r.fill(this._vertices.selection,0,0)}updateBackgrounds(t){const e=this._terminal,i=this._vertices;let s=1;for(let r=0;r<e.rows;r++){let n=-1,a=0,h=0;for(let c=0;c<e.cols;c++){const _=(r*e.cols+c)*o.RENDER_MODEL_INDICIES_PER_CELL,d=t.cells[_+o.RENDER_MODEL_BG_OFFSET],u=t.cells[_+o.RENDER_MODEL_FG_OFFSET];if(d!==a){if(0!==a){const t=s++*l;this._updateRectangle(i,t,h,a,n,c,r)}n=c,a=d,h=u}}if(0!==a){const t=s++*l;this._updateRectangle(i,t,h,a,n,e.cols,r)}}i.count=s}_updateRectangle(t,e,i,r,o,n,a){let h;const c=50331648&r;if(67108864&i)h=this._colors.foreground.rgba;else switch(c){case 16777216:case 33554432:h=this._colors.ansi[255&r].rgba;break;case 50331648:h=(16777215&r)<<8;break;case 0:default:h=this._colors.background.rgba}t.attributes.length<e+4&&(t.attributes=s.expandFloat32Array(t.attributes,this._terminal.rows*this._terminal.cols*l));const _=o*this._dimensions.scaledCellWidth,d=a*this._dimensions.scaledCellHeight,u=(h>>24&255)/255,f=(h>>16&255)/255,p=(h>>8&255)/255;this._addRectangle(t.attributes,e,_,d,(n-o)*this._dimensions.scaledCellWidth,this._dimensions.scaledCellHeight,u,f,p,1)}_addRectangle(t,e,i,s,r,o,n,a,l,h){t[e]=i,t[e+1]=s,t[e+2]=r,t[e+3]=o,t[e+4]=n,t[e+5]=a,t[e+6]=l,t[e+7]=h}_addRectangleFloat(t,e,i,s,r,o,n){t[e]=i,t[e+1]=s,t[e+2]=r,t[e+3]=o,t[e+4]=n[0],t[e+5]=n[1],t[e+6]=n[2],t[e+7]=n[3]}_colorToFloat32Array(t){return new Float32Array([(t.rgba>>24&255)/255,(t.rgba>>16&255)/255,(t.rgba>>8&255)/255,(255&t.rgba)/255])}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._disposables=[],this._isDisposed=!1}return t.prototype.dispose=function(){this._isDisposed=!0,this._disposables.forEach(function(t){return t.dispose()}),this._disposables.length=0},t.prototype.register=function(t){this._disposables.push(t)},t.prototype.unregister=function(t){var e=this._disposables.indexOf(t);-1!==e&&this._disposables.splice(e,1)},t}();e.Disposable=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(){this._listeners=[],this._disposed=!1}return Object.defineProperty(t.prototype,"event",{get:function(){var t=this;return this._event||(this._event=function(e){return t._listeners.push(e),{dispose:function(){if(!t._disposed)for(var i=0;i<t._listeners.length;i++)if(t._listeners[i]===e)return void t._listeners.splice(i,1)}}}),this._event},enumerable:!0,configurable:!0}),t.prototype.fire=function(t){for(var e=[],i=0;i<this._listeners.length;i++)e.push(this._listeners[i]);for(i=0;i<e.length;i++)e[i].call(void 0,t)},t.prototype.dispose=function(){this._listeners&&(this._listeners.length=0),this._disposed=!0},t}();e.EventEmitter=s}]);