!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var i=e();for(var s in i)("object"==typeof exports?exports:t)[s]=i[s]}}(window,(function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=10)}([function(t,e,i){"use strict";function s(t,e,i){const s=r(t.createShader(e));t.shaderSource(s,i),t.compileShader(s);if(t.getShaderParameter(s,t.COMPILE_STATUS))return s;console.error(t.getShaderInfoLog(s)),t.deleteShader(s)}function r(t){if(!t)throw new Error("value must not be falsy");return t}Object.defineProperty(e,"__esModule",{value:!0}),e.throwIfFalsy=e.expandFloat32Array=e.createShader=e.createProgram=e.PROJECTION_MATRIX=void 0,e.PROJECTION_MATRIX=new Float32Array([2,0,0,0,0,-2,0,0,0,0,1,0,-1,1,0,1]),e.createProgram=function(t,e,i){const n=r(t.createProgram());if(t.attachShader(n,r(s(t,t.VERTEX_SHADER,e))),t.attachShader(n,r(s(t,t.FRAGMENT_SHADER,i))),t.linkProgram(n),t.getProgramParameter(n,t.LINK_STATUS))return n;console.error(t.getProgramInfoLog(n)),t.deleteProgram(n)},e.createShader=s,e.expandFloat32Array=function(t,e){const i=Math.min(2*t.length,e),s=new Float32Array(i);for(let e=0;e<t.length;e++)s[e]=t[e];return s},e.throwIfFalsy=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WHITESPACE_CELL_CODE=e.WHITESPACE_CELL_WIDTH=e.WHITESPACE_CELL_CHAR=e.NULL_CELL_CODE=e.NULL_CELL_WIDTH=e.NULL_CELL_CHAR=e.CHAR_DATA_CODE_INDEX=e.CHAR_DATA_WIDTH_INDEX=e.CHAR_DATA_CHAR_INDEX=e.CHAR_DATA_ATTR_INDEX=e.DEFAULT_ATTR=e.DEFAULT_COLOR=void 0,e.DEFAULT_COLOR=256,e.DEFAULT_ATTR=256|e.DEFAULT_COLOR<<9,e.CHAR_DATA_ATTR_INDEX=0,e.CHAR_DATA_CHAR_INDEX=1,e.CHAR_DATA_WIDTH_INDEX=2,e.CHAR_DATA_CODE_INDEX=3,e.NULL_CELL_CHAR="",e.NULL_CELL_WIDTH=1,e.NULL_CELL_CODE=0,e.WHITESPACE_CELL_CHAR=" ",e.WHITESPACE_CELL_WIDTH=1,e.WHITESPACE_CELL_CODE=32},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RenderModel=e.COMBINED_CHAR_BIT_MASK=e.RENDER_MODEL_FG_OFFSET=e.RENDER_MODEL_BG_OFFSET=e.RENDER_MODEL_INDICIES_PER_CELL=void 0;const s=i(3);e.RENDER_MODEL_INDICIES_PER_CELL=3,e.RENDER_MODEL_BG_OFFSET=1,e.RENDER_MODEL_FG_OFFSET=2,e.COMBINED_CHAR_BIT_MASK=2147483648;e.RenderModel=class{constructor(){this.cells=new Uint32Array(0),this.lineLengths=new Uint32Array(0),this.selection={hasSelection:!1,columnSelectMode:!1,viewportStartRow:0,viewportEndRow:0,viewportCappedStartRow:0,viewportCappedEndRow:0,startCol:0,endCol:0}}resize(t,i){const s=t*i*e.RENDER_MODEL_INDICIES_PER_CELL;s!==this.cells.length&&(this.cells=new Uint32Array(s),this.lineLengths=new Uint32Array(i))}clear(){s.fill(this.cells,0,0),s.fill(this.lineLengths,0,0)}clearSelection(){this.selection.hasSelection=!1,this.selection.viewportStartRow=0,this.selection.viewportEndRow=0,this.selection.viewportCappedStartRow=0,this.selection.viewportCappedEndRow=0,this.selection.startCol=0,this.selection.endCol=0}}},function(t,e,i){"use strict";function s(t,e,i,s){if(void 0===i&&(i=0),void 0===s&&(s=t.length),i>=t.length)return t;i=(t.length+i)%t.length,s=s>=t.length?t.length:(t.length+s)%t.length;for(var r=i;r<s;++r)t[r]=e;return t}Object.defineProperty(e,"__esModule",{value:!0}),e.concat=e.fillFallback=e.fill=void 0,e.fill=function(t,e,i,r){return t.fill?t.fill(e,i,r):s(t,e,i,r)},e.fillFallback=s,e.concat=function(t,e){var i=new t.constructor(t.length+e.length);return i.set(t),i.set(e,t.length),i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ExtendedAttrs=e.AttributeData=void 0;var s=function(){function t(){this.fg=0,this.bg=0,this.extended=new r}return t.toColorRGB=function(t){return[t>>>16&255,t>>>8&255,255&t]},t.fromColorRGB=function(t){return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},t.prototype.clone=function(){var e=new t;return e.fg=this.fg,e.bg=this.bg,e.extended=this.extended.clone(),e},t.prototype.isInverse=function(){return 67108864&this.fg},t.prototype.isBold=function(){return 134217728&this.fg},t.prototype.isUnderline=function(){return 268435456&this.fg},t.prototype.isBlink=function(){return 536870912&this.fg},t.prototype.isInvisible=function(){return 1073741824&this.fg},t.prototype.isItalic=function(){return 67108864&this.bg},t.prototype.isDim=function(){return 134217728&this.bg},t.prototype.getFgColorMode=function(){return 50331648&this.fg},t.prototype.getBgColorMode=function(){return 50331648&this.bg},t.prototype.isFgRGB=function(){return 50331648==(50331648&this.fg)},t.prototype.isBgRGB=function(){return 50331648==(50331648&this.bg)},t.prototype.isFgPalette=function(){return 16777216==(50331648&this.fg)||33554432==(50331648&this.fg)},t.prototype.isBgPalette=function(){return 16777216==(50331648&this.bg)||33554432==(50331648&this.bg)},t.prototype.isFgDefault=function(){return 0==(50331648&this.fg)},t.prototype.isBgDefault=function(){return 0==(50331648&this.bg)},t.prototype.isAttributeDefault=function(){return 0===this.fg&&0===this.bg},t.prototype.getFgColor=function(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}},t.prototype.getBgColor=function(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}},t.prototype.hasExtendedAttrs=function(){return 268435456&this.bg},t.prototype.updateExtended=function(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456},t.prototype.getUnderlineColor=function(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()},t.prototype.getUnderlineColorMode=function(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()},t.prototype.isUnderlineColorRGB=function(){return 268435456&this.bg&&~this.extended.underlineColor?50331648==(50331648&this.extended.underlineColor):this.isFgRGB()},t.prototype.isUnderlineColorPalette=function(){return 268435456&this.bg&&~this.extended.underlineColor?16777216==(50331648&this.extended.underlineColor)||33554432==(50331648&this.extended.underlineColor):this.isFgPalette()},t.prototype.isUnderlineColorDefault=function(){return 268435456&this.bg&&~this.extended.underlineColor?0==(50331648&this.extended.underlineColor):this.isFgDefault()},t.prototype.getUnderlineStyle=function(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0},t}();e.AttributeData=s;var r=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=-1),this.underlineStyle=t,this.underlineColor=e}return t.prototype.clone=function(){return new t(this.underlineStyle,this.underlineColor)},t.prototype.isEmpty=function(){return 0===this.underlineStyle},t}();e.ExtendedAttrs=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BaseRenderLayer=void 0;const s=i(6),r=i(0);e.BaseRenderLayer=class{constructor(t,e,i,s,r){this._container=t,this._alpha=s,this._colors=r,this._scaledCharWidth=0,this._scaledCharHeight=0,this._scaledCellWidth=0,this._scaledCellHeight=0,this._scaledCharLeft=0,this._scaledCharTop=0,this._canvas=document.createElement("canvas"),this._canvas.classList.add(`xterm-${e}-layer`),this._canvas.style.zIndex=i.toString(),this._initCanvas(),this._container.appendChild(this._canvas)}dispose(){this._container.removeChild(this._canvas),this._charAtlas&&this._charAtlas.dispose()}_initCanvas(){this._ctx=r.throwIfFalsy(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}onOptionsChanged(t){}onBlur(t){}onFocus(t){}onCursorMove(t){}onGridChanged(t,e,i){}onSelectionChanged(t,e,i,s=!1){}setColors(t,e){this._refreshCharAtlas(t,e)}_setTransparency(t,e){if(e===this._alpha)return;const i=this._canvas;this._alpha=e,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,i),this._refreshCharAtlas(t,this._colors),this.onGridChanged(t,0,t.rows-1)}_refreshCharAtlas(t,e){this._scaledCharWidth<=0&&this._scaledCharHeight<=0||(this._charAtlas=s.acquireCharAtlas(t,e,this._scaledCharWidth,this._scaledCharHeight),this._charAtlas.warmUp())}resize(t,e){this._scaledCellWidth=e.scaledCellWidth,this._scaledCellHeight=e.scaledCellHeight,this._scaledCharWidth=e.scaledCharWidth,this._scaledCharHeight=e.scaledCharHeight,this._scaledCharLeft=e.scaledCharLeft,this._scaledCharTop=e.scaledCharTop,this._canvas.width=e.scaledCanvasWidth,this._canvas.height=e.scaledCanvasHeight,this._canvas.style.width=e.canvasWidth+"px",this._canvas.style.height=e.canvasHeight+"px",this._alpha||this._clearAll(),this._refreshCharAtlas(t,this._colors)}_fillCells(t,e,i,s){this._ctx.fillRect(t*this._scaledCellWidth,e*this._scaledCellHeight,i*this._scaledCellWidth,s*this._scaledCellHeight)}_fillBottomLineAtCells(t,e,i=1){this._ctx.fillRect(t*this._scaledCellWidth,(e+1)*this._scaledCellHeight-window.devicePixelRatio-1,i*this._scaledCellWidth,window.devicePixelRatio)}_fillLeftLineAtCell(t,e,i){this._ctx.fillRect(t*this._scaledCellWidth,e*this._scaledCellHeight,window.devicePixelRatio*i,this._scaledCellHeight)}_strokeRectAtCell(t,e,i,s){this._ctx.lineWidth=window.devicePixelRatio,this._ctx.strokeRect(t*this._scaledCellWidth+window.devicePixelRatio/2,e*this._scaledCellHeight+window.devicePixelRatio/2,i*this._scaledCellWidth-window.devicePixelRatio,s*this._scaledCellHeight-window.devicePixelRatio)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(t,e,i,s){this._alpha?this._ctx.clearRect(t*this._scaledCellWidth,e*this._scaledCellHeight,i*this._scaledCellWidth,s*this._scaledCellHeight):(this._ctx.fillStyle=this._colors.background.css,this._ctx.fillRect(t*this._scaledCellWidth,e*this._scaledCellHeight,i*this._scaledCellWidth,s*this._scaledCellHeight))}_fillCharTrueColor(t,e,i,s){this._ctx.font=this._getFont(t,!1,!1),this._ctx.textBaseline="middle",this._clipRow(t,s),this._ctx.fillText(e.getChars(),i*this._scaledCellWidth+this._scaledCharLeft,s*this._scaledCellHeight+this._scaledCharTop+this._scaledCharHeight/2)}_clipRow(t,e){this._ctx.beginPath(),this._ctx.rect(0,e*this._scaledCellHeight,t.cols*this._scaledCellWidth,this._scaledCellHeight),this._ctx.clip()}_getFont(t,e,i){return`${i?"italic":""} ${e?t.getOption("fontWeightBold"):t.getOption("fontWeight")} ${t.getOption("fontSize")*window.devicePixelRatio}px ${t.getOption("fontFamily")}`}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.removeTerminalFromCache=e.acquireCharAtlas=void 0;const s=i(7),r=i(15),n=[];e.acquireCharAtlas=function(t,e,i,o){const a=s.generateConfig(i,o,t,e);for(let e=0;e<n.length;e++){const i=n[e],r=i.ownedBy.indexOf(t);if(r>=0){if(s.configEquals(i.config,a))return i.atlas;1===i.ownedBy.length?(i.atlas.dispose(),n.splice(e,1)):i.ownedBy.splice(r,1);break}}for(let e=0;e<n.length;e++){const i=n[e];if(s.configEquals(i.config,a))return i.ownedBy.push(t),i.atlas}const l={atlas:new r.WebglCharAtlas(document,a),config:a,ownedBy:[t]};return n.push(l),l.atlas},e.removeTerminalFromCache=function(t){for(let e=0;e<n.length;e++){const i=n[e].ownedBy.indexOf(t);if(-1!==i){1===n[e].ownedBy.length?(n[e].atlas.dispose(),n.splice(e,1)):n[e].ownedBy.splice(i,1);break}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.is256Color=e.configEquals=e.generateConfig=void 0;const s={css:"",rgba:0};e.generateConfig=function(t,e,i,r){const n={foreground:r.foreground,background:r.background,cursor:s,cursorAccent:s,selectionTransparent:s,selectionOpaque:s,ansi:r.ansi.slice(),contrastCache:r.contrastCache};return{devicePixelRatio:window.devicePixelRatio,scaledCharWidth:t,scaledCharHeight:e,fontFamily:i.getOption("fontFamily"),fontSize:i.getOption("fontSize"),fontWeight:i.getOption("fontWeight"),fontWeightBold:i.getOption("fontWeightBold"),allowTransparency:i.getOption("allowTransparency"),drawBoldTextInBrightColors:i.getOption("drawBoldTextInBrightColors"),minimumContrastRatio:i.getOption("minimumContrastRatio"),colors:n}},e.configEquals=function(t,e){for(let i=0;i<t.colors.ansi.length;i++)if(t.colors.ansi[i].rgba!==e.colors.ansi[i].rgba)return!1;return t.devicePixelRatio===e.devicePixelRatio&&t.fontFamily===e.fontFamily&&t.fontSize===e.fontSize&&t.fontWeight===e.fontWeight&&t.fontWeightBold===e.fontWeightBold&&t.allowTransparency===e.allowTransparency&&t.scaledCharWidth===e.scaledCharWidth&&t.scaledCharHeight===e.scaledCharHeight&&t.drawBoldTextInBrightColors===e.drawBoldTextInBrightColors&&t.minimumContrastRatio===e.minimumContrastRatio&&t.colors.foreground===e.colors.foreground&&t.colors.background===e.colors.background},e.is256Color=function(t){return 16777216==(50331648&t)||33554432==(50331648&t)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CHAR_ATLAS_CELL_SPACING=e.DIM_OPACITY=e.INVERTED_DEFAULT_COLOR=void 0,e.INVERTED_DEFAULT_COLOR=257,e.DIM_OPACITY=.5,e.CHAR_ATLAS_CELL_SPACING=1},function(t,e,i){"use strict";var s,r=this&&this.__extends||(s=function(t,e){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){function i(){this.constructor=t}s(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)});Object.defineProperty(e,"__esModule",{value:!0}),e.CellData=void 0;var n=i(18),o=i(1),a=i(4),l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.content=0,e.fg=0,e.bg=0,e.extended=new a.ExtendedAttrs,e.combinedData="",e}return r(e,t),e.fromCharData=function(t){var i=new e;return i.setFromCharData(t),i},e.prototype.isCombined=function(){return 2097152&this.content},e.prototype.getWidth=function(){return this.content>>22},e.prototype.getChars=function(){return 2097152&this.content?this.combinedData:2097151&this.content?n.stringFromCodePoint(2097151&this.content):""},e.prototype.getCode=function(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content},e.prototype.setFromCharData=function(t){this.fg=t[o.CHAR_DATA_ATTR_INDEX],this.bg=0;var e=!1;if(t[o.CHAR_DATA_CHAR_INDEX].length>2)e=!0;else if(2===t[o.CHAR_DATA_CHAR_INDEX].length){var i=t[o.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=i&&i<=56319){var s=t[o.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=s&&s<=57343?this.content=1024*(i-55296)+s-56320+65536|t[o.CHAR_DATA_WIDTH_INDEX]<<22:e=!0}else e=!0}else this.content=t[o.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|t[o.CHAR_DATA_WIDTH_INDEX]<<22;e&&(this.combinedData=t[o.CHAR_DATA_CHAR_INDEX],this.content=2097152|t[o.CHAR_DATA_WIDTH_INDEX]<<22)},e.prototype.getAsCharData=function(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]},e}(a.AttributeData);e.CellData=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AframeAddon=void 0;const s=i(11);e.AframeAddon=class{constructor(t){this._gl_three=t,console.log("construct addon")}activate(t){if(!t.element)throw new Error("Cannot activate AframeAddon before Terminal.open");this._terminal=t;t._core._renderService;const e=t._core._colorManager.colors;this._renderer=new s.AframeRenderer(t,e,this._gl_three),this._size=new AFRAME.THREE.Vector3(this._renderer.dimensions.scaledCanvasWidth,this._renderer.dimensions.scaledCanvasHeight,0)}dispose(){if(!this._terminal)throw new Error("Cannot dispose WebglAddon because it is activated");const t=this._terminal._core._renderService;t.setRenderer(this._terminal._core._createRenderer()),t.onResize(this._terminal.cols,this._terminal.rows),this._renderer=void 0}get textureAtlas(){var t;return null===(t=this._renderer)||void 0===t?void 0:t.textureAtlas}get bufferGeometry(){var t;return null===(t=this._renderer)||void 0===t?void 0:t.bufferGeometry}get shaderMaterial(){var t;return null===(t=this._renderer)||void 0===t?void 0:t.shaderMaterial}get canvasSize(){return this._size}clearTextureAtlas(){var t;null===(t=this._renderer)||void 0===t||t.clearCharAtlas()}tick(){var t;null===(t=this._renderer)||void 0===t||t.updateRows(0,24)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AframeRenderer=void 0;const s=i(12),r=i(14),n=i(17),o=i(6),a=i(19),l=i(2),h=i(20),c=i(1),d=i(21),_=i(9);class u extends h.Disposable{constructor(t,e,i){if(super(),this._terminal=t,this._colors=e,this._gl_three=i,this._model=new l.RenderModel,this._workCell=new _.CellData,this._onRequestRedraw=new d.EventEmitter,this._core=this._terminal._core,this._renderLayers=[new r.LinkRenderLayer(this._core.screenElement,2,this._colors,this._core),new n.CursorRenderLayer(this._core.screenElement,3,this._colors,this._onRequestRedraw)],this.dimensions={scaledCharWidth:0,scaledCharHeight:0,scaledCellWidth:0,scaledCellHeight:0,scaledCharLeft:0,scaledCharTop:0,scaledCanvasWidth:0,scaledCanvasHeight:0,canvasWidth:0,canvasHeight:0,actualCellWidth:0,actualCellHeight:0},this._devicePixelRatio=window.devicePixelRatio,this._updateDimensions(),console.log("canvas -----------------------------v"),this._canvas=document.createElement("canvas"),this._gl=this._gl_three,!this._gl)throw new Error("WebGL2 not supported "+this._gl);this._core.screenElement.appendChild(this._canvas),this._rectangleRenderer=new a.RectangleRenderer(this._terminal,this._colors,this._gl,this.dimensions),this._glyphRenderer=new s.AframeGlyphRenderer(this._terminal,this._colors,this._gl,this.dimensions),this.onCharSizeChanged(),this._isAttached=document.body.contains(this._core.screenElement)}get onRequestRedraw(){return this._onRequestRedraw.event}get bufferGeometry(){return this._glyphRenderer.getBufferGeometry}get shaderMaterial(){return this._glyphRenderer.shaderMaterial}get textureObject(){return this._glyphRenderer._atlasTexture}dispose(){this._renderLayers.forEach(t=>t.dispose()),this._core.screenElement.removeChild(this._canvas),super.dispose()}get textureAtlas(){var t;return null===(t=this._charAtlas)||void 0===t?void 0:t.cacheCanvas}setColors(t){this._colors=t,this._renderLayers.forEach(t=>{t.setColors(this._terminal,this._colors),t.reset(this._terminal)}),this._rectangleRenderer.setColors(),this._glyphRenderer.setColors(),this._refreshCharAtlas(),this._rectangleRenderer.updateSelection(this._model.selection),this._glyphRenderer.updateSelection(this._model),this._model.clear(),this._model.clearSelection()}onDevicePixelRatioChange(){this._devicePixelRatio!==window.devicePixelRatio&&(this._devicePixelRatio=window.devicePixelRatio,this.onResize(this._terminal.cols,this._terminal.rows))}onResize(t,e){this._updateDimensions(),this._model.resize(this._terminal.cols,this._terminal.rows),this._rectangleRenderer.onResize(),this._renderLayers.forEach(t=>t.resize(this._terminal,this.dimensions)),this._canvas.width=this.dimensions.scaledCanvasWidth,this._canvas.height=this.dimensions.scaledCanvasHeight,this._canvas.style.width=this.dimensions.canvasWidth+"px",this._canvas.style.height=this.dimensions.canvasHeight+"px",this._core.screenElement.style.width=this.dimensions.canvasWidth+"px",this._core.screenElement.style.height=this.dimensions.canvasHeight+"px",this._glyphRenderer.setDimensions(this.dimensions),this._glyphRenderer.onResize(),this._refreshCharAtlas(),this._model.clear(),this._model.clearSelection()}onCharSizeChanged(){this.onResize(this._terminal.cols,this._terminal.rows)}onBlur(){this._renderLayers.forEach(t=>t.onBlur(this._terminal))}onFocus(){this._renderLayers.forEach(t=>t.onFocus(this._terminal))}onSelectionChanged(t,e,i){this._renderLayers.forEach(s=>s.onSelectionChanged(this._terminal,t,e,i)),this._updateSelectionModel(t,e,i),this._rectangleRenderer.updateSelection(this._model.selection),this._glyphRenderer.updateSelection(this._model),this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}onCursorMove(){this._renderLayers.forEach(t=>t.onCursorMove(this._terminal))}onOptionsChanged(){this._renderLayers.forEach(t=>t.onOptionsChanged(this._terminal)),this._updateDimensions(),this._refreshCharAtlas()}_refreshCharAtlas(){if(this.dimensions.scaledCharWidth<=0&&this.dimensions.scaledCharHeight<=0)return void(this._isAttached=!1);const t=o.acquireCharAtlas(this._terminal,this._colors,this.dimensions.scaledCharWidth,this.dimensions.scaledCharHeight);if(!("getRasterizedGlyph"in t))throw new Error("The webgl renderer only works with the webgl char atlas");this._charAtlas=t,this._charAtlas.warmUp(),this._glyphRenderer.setAtlas(this._charAtlas),console.log("canvas warmup--------------- USE CanvasTexture")}clearCharAtlas(){var t;null===(t=this._charAtlas)||void 0===t||t.clearTexture(),this._model.clear(),this._updateModel(0,this._terminal.rows-1),this._glyphRenderer.updateSelection(this._model),this._onRequestRedraw.fire({start:0,end:this._terminal.rows-1})}clear(){this._renderLayers.forEach(t=>t.reset(this._terminal))}registerCharacterJoiner(t){return-1}deregisterCharacterJoiner(t){return!1}updateRows(t,e){if(!this._isAttached){if(!(document.body.contains(this._core.screenElement)&&this._core._charSizeService.width&&this._core._charSizeService.height))return;this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0}this._renderLayers.forEach(i=>i.onGridChanged(this._terminal,t,e)),this._glyphRenderer.beginFrame()&&(this._model.clear(),this._model.clearSelection()),this._updateModel(t,e),this._glyphRenderer.debug()}renderRows(t,e){if(!this._isAttached){if(!(document.body.contains(this._core.screenElement)&&this._core._charSizeService.width&&this._core._charSizeService.height))return;this._updateDimensions(),this._refreshCharAtlas(),this._isAttached=!0}this._renderLayers.forEach(i=>i.onGridChanged(this._terminal,t,e)),this._glyphRenderer.beginFrame()&&(this._model.clear(),this._model.clearSelection()),this._updateModel(t,e),this._glyphRenderer.updateAtlas()}_updateModel(t,e){const i=this._core;for(let s=t;s<=e;s++){const t=s+i.buffer.ydisp,e=i.buffer.lines.get(t);this._model.lineLengths[s]=0;for(let t=0;t<i.cols;t++){e.loadCell(t,this._workCell);const r=this._workCell.getChars();let n=this._workCell.getCode();const o=(s*i.cols+t)*l.RENDER_MODEL_INDICIES_PER_CELL;n!==c.NULL_CELL_CODE&&(this._model.lineLengths[s]=t+1),this._model.cells[o]===n&&this._model.cells[o+l.RENDER_MODEL_BG_OFFSET]===this._workCell.bg&&this._model.cells[o+l.RENDER_MODEL_FG_OFFSET]===this._workCell.fg||(r.length>1&&(n|=l.COMBINED_CHAR_BIT_MASK),this._model.cells[o]=n,this._model.cells[o+l.RENDER_MODEL_BG_OFFSET]=this._workCell.bg,this._model.cells[o+l.RENDER_MODEL_FG_OFFSET]=this._workCell.fg,this._glyphRenderer.updateCell(t,s,n,this._workCell.bg,this._workCell.fg,r))}}this._rectangleRenderer.updateBackgrounds(this._model)}_updateSelectionModel(t,e,i){const s=this._terminal;if(!t||!e||t[0]===e[0]&&t[1]===e[1])return void this._model.clearSelection();const r=t[1]-s.buffer.active.viewportY,n=e[1]-s.buffer.active.viewportY,o=Math.max(r,0),a=Math.min(n,s.rows-1);o>=s.rows||a<0?this._model.clearSelection():(this._model.selection.hasSelection=!0,this._model.selection.columnSelectMode=i,this._model.selection.viewportStartRow=r,this._model.selection.viewportEndRow=n,this._model.selection.viewportCappedStartRow=o,this._model.selection.viewportCappedEndRow=a,this._model.selection.startCol=t[0],this._model.selection.endCol=e[0])}_updateDimensions(){this._core._charSizeService.width&&this._core._charSizeService.height&&(this.dimensions.scaledCharWidth=Math.floor(this._core._charSizeService.width*this._devicePixelRatio),this.dimensions.scaledCharHeight=Math.ceil(this._core._charSizeService.height*this._devicePixelRatio),this.dimensions.scaledCellHeight=Math.floor(this.dimensions.scaledCharHeight*this._terminal.getOption("lineHeight")),this.dimensions.scaledCharTop=1===this._terminal.getOption("lineHeight")?0:Math.round((this.dimensions.scaledCellHeight-this.dimensions.scaledCharHeight)/2),this.dimensions.scaledCellWidth=this.dimensions.scaledCharWidth+Math.round(this._terminal.getOption("letterSpacing")),this.dimensions.scaledCharLeft=Math.floor(this._terminal.getOption("letterSpacing")/2),this.dimensions.scaledCanvasHeight=this._terminal.rows*this.dimensions.scaledCellHeight,this.dimensions.scaledCanvasWidth=this._terminal.cols*this.dimensions.scaledCellWidth,this.dimensions.canvasHeight=Math.round(this.dimensions.scaledCanvasHeight/this._devicePixelRatio),this.dimensions.canvasWidth=Math.round(this.dimensions.scaledCanvasWidth/this._devicePixelRatio),this.dimensions.actualCellHeight=this.dimensions.scaledCellHeight/this._devicePixelRatio,this.dimensions.actualCellWidth=this.dimensions.scaledCellWidth/this._devicePixelRatio)}}e.AframeRenderer=u},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AframeGlyphRenderer=void 0;const s=i(0),r=i(2),n=i(3),o=i(13),a=i(1),l=i(4);e.AframeGlyphRenderer=class{constructor(t,e,i,r){this._terminal=t,this._colors=e,this._gl=i,this._dimensions=r,this._activeBuffer=0,this._vertices={count:0,attributes:new Float32Array(0),pos_attributes:new Float32Array(8),uv_attributes:new Float32Array(8),norm_attributes:new Float32Array(8),attributesBuffers:[new Float32Array(8),new Float32Array(8)],selectionAttributes:new Float32Array(0)};const n=this._gl;this.positions=new Float32Array(24e3),this.uvs=new Float32Array(24e3),this.idx=new Uint32Array(24e3),console.log("positions buffernum: ",this.positions.buffer.byteLength),console.log("uvs buffernum: ",this.uvs.buffer.byteLength),this._atlasTexture=s.throwIfFalsy(n.createTexture()),n.bindTexture(n.TEXTURE_2D,this._atlasTexture),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this._aframebuffergeometry=new AFRAME.THREE.BufferGeometry,this._aframe_pos_att=new AFRAME.THREE.BufferAttribute(this.positions,3),this._aframe_uv_att=new AFRAME.THREE.BufferAttribute(this.uvs,2),this._aframe_pos_att.usage=AFRAME.THREE.DynamicDrawUsage,this._aframe_uv_att.usage=AFRAME.THREE.DynamicDrawUsage,this._aframebuffergeometry.setAttribute("position",this._aframe_pos_att),this._aframebuffergeometry.setAttribute("uv",this._aframe_uv_att),this._aframebuffergeometry.dynamic=!0,this._aframebuffergeometry.attributes.position.needsUpdate=!0,this._aframebuffergeometry.attributes.uv.needsUpdate=!0,this._aframebuffergeometry.setIndex(new AFRAME.THREE.BufferAttribute(this.idx,1)),this._aframebuffergeometry.index.needsUpdate=!0,this.onResize()}updateCell(t,e,i,s,r,n){this._updateCell(this.positions,this.uvs,this.idx,t,e,i,s,r,n),this._aframebuffergeometry.attributes.position.needsUpdate=!0,this._aframebuffergeometry.attributes.uv.needsUpdate=!0,this._aframebuffergeometry.index.needsUpdate=!0}debug(){}_updateCell(t,e,i,s,r,o,l,h,c){const d=this._terminal,_=12*(r*d.cols+s),u=8*(r*d.cols+s);if(o===a.NULL_CELL_CODE||o===a.WHITESPACE_CELL_CODE||void 0===o)return n.fill(t,0,_,_+12-1-2),void n.fill(e,0,_,_+12-1-2);let f;if(!this._atlas)return;if(f=c&&c.length>1?this._atlas.getRasterizedGlyphCombinedChar(c,l,h):this._atlas.getRasterizedGlyph(o,l,h),!f)return n.fill(t,0,_,_+12-1-2),void n.fill(e,0,_,_+12-1-2);let g=this._dimensions.scaledCharHeight/this._dimensions.scaledCanvasHeight,C=r/d.rows*this._dimensions.scaledCharHeight,p=s*this._dimensions.scaledCanvasHeight/this._dimensions.scaledCanvasWidth/2,m=g*f.offset.y-C,v=g*(f.offset.y-f.size.y)-C,R=g*-f.offset.x+p,w=g*(-f.offset.x+f.size.x)+p;t.set([R,m,0,w,m,0,R,v,0,w,v,0],_);let b=4*(r*d.cols+s);i.set([b+2,b+1,b,b+2,b+3,b+1],6*(r*d.cols+s));let A=1-f.texturePositionClipSpace.y,E=A-f.sizeClipSpace.y,y=f.texturePositionClipSpace.x,x=y+f.sizeClipSpace.x;e.set([y,A,x,A,y,E,x,E],u)}get_pos(t,e){return"("+t[e].toFixed(2)+", "+t[e+1].toFixed(2)+", "+t[e+2].toFixed(2)+")"}updateAtlas(){}_getColorFromAnsiIndex(t){if(t>=this._colors.ansi.length)throw new Error("No color found for idx "+t);return this._colors.ansi[t]}onResize(){const t=this._terminal,e=t.cols*t.rows*12;if(this._vertices.count!==e){this._vertices.count=e,this._vertices.attributes=new Float32Array(e),console.log("new count = ",e),this._vertices.pos_attributes=new Float32Array(3*e),this._vertices.uv_attributes=new Float32Array(2*e);for(let t=0;t<this._vertices.attributesBuffers.length;t++)this._vertices.attributesBuffers[t]=new Float32Array(e);let i=0;for(let e=0;e<t.rows;e++)for(let s=0;s<t.cols;s++)this._vertices.attributes[i+8]=s/t.cols,this._vertices.attributes[i+9]=e/t.rows,i+=12}}render(t,e){}setAtlas(t){const e=this._gl;this._atlas=t,e.bindTexture(e.TEXTURE_2D,this._atlasTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t.cacheCanvas),e.generateMipmap(e.TEXTURE_2D)}setDimensions(t){this._dimensions=t}get getBufferGeometry(){return this._aframebuffergeometry}get shaderMaterial(){return this._aframeshadermaterial}get termIndex(){return this.idx}beginFrame(){return!this._atlas||this._atlas.beginFrame()}setColors(){}updateSelection(t){const e=this._terminal;this._vertices.selectionAttributes=o.slice(this._vertices.attributes,0);const i=this._colors.selectionOpaque.rgba>>>8|50331648;if(t.selection.columnSelectMode){const e=t.selection.startCol,s=t.selection.endCol-e,r=t.selection.viewportCappedEndRow-t.selection.viewportCappedStartRow+1;for(let n=t.selection.viewportCappedStartRow;n<t.selection.viewportCappedStartRow+r;n++)this._updateSelectionRange(e,e+s,n,t,i)}else{const s=t.selection.viewportStartRow===t.selection.viewportCappedStartRow?t.selection.startCol:0,r=t.selection.viewportCappedStartRow===t.selection.viewportCappedEndRow?t.selection.endCol:e.cols;this._updateSelectionRange(s,r,t.selection.viewportCappedStartRow,t,i);const n=Math.max(t.selection.viewportCappedEndRow-t.selection.viewportCappedStartRow-1,0);for(let e=t.selection.viewportCappedStartRow+1;e<=t.selection.viewportCappedStartRow+n;e++)this._updateSelectionRange(0,r,e,t,i);if(t.selection.viewportCappedStartRow!==t.selection.viewportCappedEndRow){const s=t.selection.viewportEndRow===t.selection.viewportCappedEndRow?t.selection.endCol:e.cols;this._updateSelectionRange(0,s,t.selection.viewportCappedEndRow,t,i)}}}_updateSelectionRange(t,e,i,s,n){const o=this._terminal,a=i+o.buffer.active.viewportY;let h;for(let n=t;n<e;n++){const t=(i*this._terminal.cols+n)*r.RENDER_MODEL_INDICIES_PER_CELL,e=s.cells[t];let c=s.cells[t+r.RENDER_MODEL_FG_OFFSET];if(67108864&c){const e=new l.AttributeData;switch(e.fg=c,e.bg=s.cells[t+r.RENDER_MODEL_BG_OFFSET],c&=-134217728,e.getBgColorMode()){case 16777216:case 33554432:const t=this._getColorFromAnsiIndex(e.getBgColor()).rgba;c|=t>>8&16711680|t>>8&65280|t>>8&255;case 50331648:const i=l.AttributeData.toColorRGB(e.getBgColor());c|=i[0]<<16|i[1]<<8|i[2]<<0;case 0:default:const s=this._colors.background.rgba;c|=s>>8&16711680|s>>8&65280|s>>8&255}c|=50331648}if(e&r.COMBINED_CHAR_BIT_MASK){h||(h=o.buffer.active.getLine(a));h.getCell(n).getChars()}}}}},function(t,e,i){"use strict";function s(t,e=0,i=t.length){e<0&&(e=(t.length+e)%t.length),i=i>=t.length?t.length:(t.length+i)%t.length,e=Math.min(e,i);const s=new t.constructor(i-e);for(let r=0;r<i-e;++r)s[r]=t[r+e];return s}Object.defineProperty(e,"__esModule",{value:!0}),e.sliceFallback=e.slice=void 0,e.slice=function(t,e,i){return t.slice?t.slice(e,i):s(t,e,i)},e.sliceFallback=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LinkRenderLayer=void 0;const s=i(5),r=i(8),n=i(7);class o extends s.BaseRenderLayer{constructor(t,e,i,s){super(t,"link",e,!0,i),s.linkifier.onShowLinkUnderline(t=>this._onShowLinkUnderline(t)),s.linkifier.onHideLinkUnderline(t=>this._onHideLinkUnderline(t)),s.linkifier2.onShowLinkUnderline(t=>this._onShowLinkUnderline(t)),s.linkifier2.onHideLinkUnderline(t=>this._onHideLinkUnderline(t))}resize(t,e){super.resize(t,e),this._state=void 0}reset(t){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);const t=this._state.y2-this._state.y1-1;t>0&&this._clearCells(0,this._state.y1+1,this._state.cols,t),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_onShowLinkUnderline(t){if(t.fg===r.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._colors.background.css:void 0!==t.fg&&n.is256Color(t.fg)?this._ctx.fillStyle=this._colors.ansi[t.fg].css:this._ctx.fillStyle=this._colors.foreground.css,t.y1===t.y2)this._fillBottomLineAtCells(t.x1,t.y1,t.x2-t.x1);else{this._fillBottomLineAtCells(t.x1,t.y1,t.cols-t.x1);for(let e=t.y1+1;e<t.y2;e++)this._fillBottomLineAtCells(0,e,t.cols);this._fillBottomLineAtCells(0,t.y2,t.x2)}this._state=t}_onHideLinkUnderline(t){this._clearCurrentLink()}}e.LinkRenderLayer=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WebglCharAtlas=void 0;const s=i(8),r=i(1),n=i(0),o=i(4),a=i(16),l=Math.floor(819.2),h={css:"rgba(0, 0, 0, 0)",rgba:0},c={offset:{x:0,y:0},texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}};function d(t){const e=t.toString(16);return e.length<2?"0"+e:e}e.WebglCharAtlas=class{constructor(t,e){this._config=e,this._didWarmUp=!1,this._cacheMap={},this._cacheMapCombined={},this._currentRowY=0,this._currentRowX=0,this._currentRowHeight=0,this.hasCanvasChanged=!1,this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new o.AttributeData,this.cacheCanvas=t.createElement("canvas"),this.cacheCanvas.width=1024,this.cacheCanvas.height=1024,this._cacheCtx=n.throwIfFalsy(this.cacheCanvas.getContext("2d",{alpha:!0})),this._tmpCanvas=t.createElement("canvas"),this._tmpCanvas.width=2*this._config.scaledCharWidth+4,this._tmpCanvas.height=this._config.scaledCharHeight+4,this._tmpCtx=n.throwIfFalsy(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency}))}dispose(){this.cacheCanvas.parentElement&&this.cacheCanvas.parentElement.removeChild(this.cacheCanvas)}warmUp(){this._didWarmUp||(this._doWarmUp(),this._didWarmUp=!0)}_doWarmUp(){for(let t=33;t<126;t++){const e=this._drawToCache(t,r.DEFAULT_COLOR,r.DEFAULT_COLOR);this._cacheMap[t]={[r.DEFAULT_COLOR]:{[r.DEFAULT_COLOR]:e}}}}beginFrame(){return this._currentRowY>l&&(this.clearTexture(),this.warmUp(),!0)}clearTexture(){0===this._currentRowX&&0===this._currentRowY||(this._cacheCtx.clearRect(0,0,1024,1024),this._cacheMap={},this._cacheMapCombined={},this._currentRowHeight=0,this._currentRowX=0,this._currentRowY=0,this._didWarmUp=!1)}getRasterizedGlyphCombinedChar(t,e,i){let s,r=this._cacheMapCombined[t];r||(r={},this._cacheMapCombined[t]=r);const n=r[e];return n&&(s=n[i]),s||(s=this._drawToCache(t,e,i),r[e]||(r[e]={}),r[e][i]=s),s}getRasterizedGlyph(t,e,i){let s,r=this._cacheMap[t];r||(r={},this._cacheMap[t]=r);const n=r[e];return n&&(s=n[i]),s||(s=this._drawToCache(t,e,i),r[e]||(r[e]={}),r[e][i]=s),s}_getColorFromAnsiIndex(t){if(t>=this._config.colors.ansi.length)throw new Error("No color found for idx "+t);return this._config.colors.ansi[t]}_getBackgroundColor(t,e,i){if(this._config.allowTransparency)return h;switch(t){case 16777216:case 33554432:return this._getColorFromAnsiIndex(e);case 50331648:const t=o.AttributeData.toColorRGB(e);return{rgba:e<<8,css:`#${d(t[0])}${d(t[1])}${d(t[2])}`};case 0:default:return i?this._config.colors.foreground:this._config.colors.background}}_getForegroundCss(t,e,i,s,r,n,l,h){const c=this._getMinimumContrastCss(t,e,i,s,r,n,l,h);if(c)return c;switch(r){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&h&&n<8&&(n+=8),this._getColorFromAnsiIndex(n).css;case 50331648:const t=o.AttributeData.toColorRGB(n);return a.channels.toCss(t[0],t[1],t[2]);case 0:default:if(l){const t=this._config.colors.background.css;return 9===t.length?t.substr(0,7):t}return this._config.colors.foreground.css}}_resolveBackgroundRgba(t,e,i){switch(t){case 16777216:case 33554432:return this._getColorFromAnsiIndex(e).rgba;case 50331648:return e<<8;case 0:default:return i?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(t,e,i,s){switch(t){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&s&&e<8&&(e+=8),this._getColorFromAnsiIndex(e).rgba;case 50331648:return e<<8;case 0:default:return i?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastCss(t,e,i,s,r,n,o,l){if(1===this._config.minimumContrastRatio)return;const h=this._config.colors.contrastCache.getCss(t,s);if(void 0!==h)return h||void 0;const c=this._resolveBackgroundRgba(e,i,o),d=this._resolveForegroundRgba(r,n,o,l),_=a.rgba.ensureContrastRatio(c,d,this._config.minimumContrastRatio);if(!_)return void this._config.colors.contrastCache.setCss(t,s,null);const u=a.channels.toCss(_>>24&255,_>>16&255,_>>8&255);return this._config.colors.contrastCache.setCss(t,s,u),u}_drawToCache(t,e,i){const r="number"==typeof t?String.fromCharCode(t):t;this.hasCanvasChanged=!0,this._tmpCtx.save(),this._workAttributeData.fg=i,this._workAttributeData.bg=e;if(!!this._workAttributeData.isInvisible())return c;const n=!!this._workAttributeData.isBold(),o=!!this._workAttributeData.isInverse(),a=!!this._workAttributeData.isDim(),l=!!this._workAttributeData.isItalic();let h=this._workAttributeData.getFgColor(),d=this._workAttributeData.getFgColorMode(),_=this._workAttributeData.getBgColor(),u=this._workAttributeData.getBgColorMode();if(o){const t=h;h=_,_=t;const e=d;d=u,u=e}const f=this._getBackgroundColor(u,_,o);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=f.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";const g=n?this._config.fontWeightBold:this._config.fontWeight,C=l?"italic":"";this._tmpCtx.font=`${C} ${g} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline="middle",this._tmpCtx.fillStyle=this._getForegroundCss(e,u,_,i,d,h,o,n),a&&(this._tmpCtx.globalAlpha=s.DIM_OPACITY),this._tmpCtx.fillText(r,2,2+this._config.scaledCharHeight/2),this._tmpCtx.restore();const p=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height);if(function(t,e){let i=!0;const s=e.rgba>>>24,r=e.rgba>>>16&255,n=e.rgba>>>8&255;for(let e=0;e<t.data.length;e+=4)t.data[e]===s&&t.data[e+1]===r&&t.data[e+2]===n?t.data[e+3]=0:i=!1;return i}(p,f))return c;const m=this._findGlyphBoundingBox(p,this._workBoundingBox),v=this._clipImageData(p,this._workBoundingBox);return this._currentRowX+this._config.scaledCharWidth>1024&&(this._currentRowX=0,this._currentRowY+=this._currentRowHeight,this._currentRowHeight=0),m.texturePosition.x=this._currentRowX,m.texturePosition.y=this._currentRowY,m.texturePositionClipSpace.x=this._currentRowX/1024,m.texturePositionClipSpace.y=this._currentRowY/1024,this._currentRowHeight=Math.max(this._currentRowHeight,m.size.y),this._currentRowX+=m.size.x,this._cacheCtx.putImageData(v,m.texturePosition.x,m.texturePosition.y),m}_findGlyphBoundingBox(t,e){e.top=0;let i=!1;for(let s=0;s<this._tmpCanvas.height;s++){for(let r=0;r<this._tmpCanvas.width;r++){const n=s*this._tmpCanvas.width*4+4*r+3;if(0!==t.data[n]){e.top=s,i=!0;break}}if(i)break}e.left=0,i=!1;for(let s=0;s<this._tmpCanvas.width;s++){for(let r=0;r<this._tmpCanvas.height;r++){const n=r*this._tmpCanvas.width*4+4*s+3;if(0!==t.data[n]){e.left=s,i=!0;break}}if(i)break}e.right=this._tmpCanvas.width,i=!1;for(let s=this._tmpCanvas.width-1;s>=0;s--){for(let r=0;r<this._tmpCanvas.height;r++){const n=r*this._tmpCanvas.width*4+4*s+3;if(0!==t.data[n]){e.right=s,i=!0;break}}if(i)break}e.bottom=this._tmpCanvas.height,i=!1;for(let s=this._tmpCanvas.height-1;s>=0;s--){for(let r=0;r<this._tmpCanvas.width;r++){const n=s*this._tmpCanvas.width*4+4*r+3;if(0!==t.data[n]){e.bottom=s,i=!0;break}}if(i)break}return{texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:e.right-e.left+1,y:e.bottom-e.top+1},sizeClipSpace:{x:(e.right-e.left+1)/1024,y:(e.bottom-e.top+1)/1024},offset:{x:2-e.left,y:2-e.top}}}_clipImageData(t,e){const i=e.right-e.left+1,s=e.bottom-e.top+1,r=new Uint8ClampedArray(i*s*4);for(let s=e.top;s<=e.bottom;s++)for(let n=e.left;n<=e.right;n++){const o=s*this._tmpCanvas.width*4+4*n,a=(s-e.top)*i*4+4*(n-e.left);r[a]=t.data[o],r[a+1]=t.data[o+1],r[a+2]=t.data[o+2],r[a+3]=t.data[o+3]}return new ImageData(r,i,s)}}},function(t,e,i){"use strict";var s,r,n,o;function a(t){var e=t.toString(16);return e.length<2?"0"+e:e}function l(t,e){return t<e?(e+.05)/(t+.05):(t+.05)/(e+.05)}Object.defineProperty(e,"__esModule",{value:!0}),e.contrastRatio=e.toPaddedHex=e.rgba=e.rgb=e.css=e.color=e.channels=void 0,function(t){t.toCss=function(t,e,i,s){return void 0!==s?"#"+a(t)+a(e)+a(i)+a(s):"#"+a(t)+a(e)+a(i)},t.toRgba=function(t,e,i,s){return void 0===s&&(s=255),(t<<24|e<<16|i<<8|s)>>>0}}(s=e.channels||(e.channels={})),(r=e.color||(e.color={})).blend=function(t,e){var i=(255&e.rgba)/255;if(1===i)return{css:e.css,rgba:e.rgba};var r=e.rgba>>24&255,n=e.rgba>>16&255,o=e.rgba>>8&255,a=t.rgba>>24&255,l=t.rgba>>16&255,h=t.rgba>>8&255,c=a+Math.round((r-a)*i),d=l+Math.round((n-l)*i),_=h+Math.round((o-h)*i);return{css:s.toCss(c,d,_),rgba:s.toRgba(c,d,_)}},r.isOpaque=function(t){return 255==(255&t.rgba)},r.ensureContrastRatio=function(t,e,i){var s=o.ensureContrastRatio(t.rgba,e.rgba,i);if(s)return o.toColor(s>>24&255,s>>16&255,s>>8&255)},r.opaque=function(t){var e=(255|t.rgba)>>>0,i=o.toChannels(e),r=i[0],n=i[1],a=i[2];return{css:s.toCss(r,n,a),rgba:e}},r.opacity=function(t,e){var i=Math.round(255*e),r=o.toChannels(t.rgba),n=r[0],a=r[1],l=r[2];return{css:s.toCss(n,a,l,i),rgba:s.toRgba(n,a,l,i)}},(e.css||(e.css={})).toColor=function(t){switch(t.length){case 7:return{css:t,rgba:(parseInt(t.slice(1),16)<<8|255)>>>0};case 9:return{css:t,rgba:parseInt(t.slice(1),16)>>>0}}throw new Error("css.toColor: Unsupported css format")},function(t){function e(t,e,i){var s=t/255,r=e/255,n=i/255;return.2126*(s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4))+.7152*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))+.0722*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))}t.relativeLuminance=function(t){return e(t>>16&255,t>>8&255,255&t)},t.relativeLuminance2=e}(n=e.rgb||(e.rgb={})),function(t){function e(t,e,i){for(var s=t>>24&255,r=t>>16&255,o=t>>8&255,a=e>>24&255,h=e>>16&255,c=e>>8&255,d=l(n.relativeLuminance2(a,c,h),n.relativeLuminance2(s,r,o));d<i&&(a>0||h>0||c>0);)a-=Math.max(0,Math.ceil(.1*a)),h-=Math.max(0,Math.ceil(.1*h)),c-=Math.max(0,Math.ceil(.1*c)),d=l(n.relativeLuminance2(a,c,h),n.relativeLuminance2(s,r,o));return(a<<24|h<<16|c<<8|255)>>>0}function i(t,e,i){for(var s=t>>24&255,r=t>>16&255,o=t>>8&255,a=e>>24&255,h=e>>16&255,c=e>>8&255,d=l(n.relativeLuminance2(a,c,h),n.relativeLuminance2(s,r,o));d<i&&(a<255||h<255||c<255);)a=Math.min(255,a+Math.ceil(.1*(255-a))),h=Math.min(255,h+Math.ceil(.1*(255-h))),c=Math.min(255,c+Math.ceil(.1*(255-c))),d=l(n.relativeLuminance2(a,c,h),n.relativeLuminance2(s,r,o));return(a<<24|h<<16|c<<8|255)>>>0}t.ensureContrastRatio=function(t,s,r){var o=n.relativeLuminance(t>>8),a=n.relativeLuminance(s>>8);if(l(o,a)<r)return a<o?e(t,s,r):i(t,s,r)},t.reduceLuminance=e,t.increaseLuminance=i,t.toChannels=function(t){return[t>>24&255,t>>16&255,t>>8&255,255&t]},t.toColor=function(t,e,i){return{css:s.toCss(t,e,i),rgba:s.toRgba(t,e,i)}}}(o=e.rgba||(e.rgba={})),e.toPaddedHex=a,e.contrastRatio=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CursorRenderLayer=void 0;const s=i(5),r=i(9);class n extends s.BaseRenderLayer{constructor(t,e,i,s){super(t,"cursor",e,!0,i),this._onRequestRefreshRowsEvent=s,this._cell=new r.CellData,this._state={x:0,y:0,isFocused:!1,style:"",width:0},this._cursorRenderers={bar:this._renderBarCursor.bind(this),block:this._renderBlockCursor.bind(this),underline:this._renderUnderlineCursor.bind(this)}}resize(t,e){super.resize(t,e),this._state={x:0,y:0,isFocused:!1,style:"",width:0}}reset(t){this._clearCursor(),this._cursorBlinkStateManager&&(this._cursorBlinkStateManager.dispose(),this.onOptionsChanged(t))}onBlur(t){this._cursorBlinkStateManager&&this._cursorBlinkStateManager.pause(),this._onRequestRefreshRowsEvent.fire({start:t.buffer.active.cursorY,end:t.buffer.active.cursorY})}onFocus(t){this._cursorBlinkStateManager?this._cursorBlinkStateManager.resume(t):this._onRequestRefreshRowsEvent.fire({start:t.buffer.active.cursorY,end:t.buffer.active.cursorY})}onOptionsChanged(t){var e;t.getOption("cursorBlink")?this._cursorBlinkStateManager||(this._cursorBlinkStateManager=new o(t,()=>{this._render(t,!0)})):(null===(e=this._cursorBlinkStateManager)||void 0===e||e.dispose(),this._cursorBlinkStateManager=void 0),this._onRequestRefreshRowsEvent.fire({start:t.buffer.active.cursorY,end:t.buffer.active.cursorY})}onCursorMove(t){this._cursorBlinkStateManager&&this._cursorBlinkStateManager.restartBlinkAnimation(t)}onGridChanged(t,e,i){!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isPaused?this._render(t,!1):this._cursorBlinkStateManager.restartBlinkAnimation(t)}_render(t,e){if(!t._core._coreService.isCursorInitialized||t._core._coreService.isCursorHidden)return void this._clearCursor();const i=t.buffer.active.baseY+t.buffer.active.cursorY,s=i-t.buffer.active.viewportY,r=Math.min(t.buffer.active.cursorX,t.cols-1);if(s<0||s>=t.rows)this._clearCursor();else if(t._core.buffer.lines.get(i).loadCell(r,this._cell),void 0!==this._cell.content){if(!a(t)){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css;const e=t.getOption("cursorStyle");return e&&"block"!==e?this._cursorRenderers[e](t,r,s,this._cell):this._renderBlurCursor(t,r,s,this._cell),this._ctx.restore(),this._state.x=r,this._state.y=s,this._state.isFocused=!1,this._state.style=e,void(this._state.width=this._cell.getWidth())}if(!this._cursorBlinkStateManager||this._cursorBlinkStateManager.isCursorVisible){if(this._state){if(this._state.x===r&&this._state.y===s&&this._state.isFocused===a(t)&&this._state.style===t.getOption("cursorStyle")&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[t.getOption("cursorStyle")||"block"](t,r,s,this._cell),this._ctx.restore(),this._state.x=r,this._state.y=s,this._state.isFocused=!1,this._state.style=t.getOption("cursorStyle"),this._state.width=this._cell.getWidth()}else this._clearCursor()}}_clearCursor(){this._state&&(this._clearCells(this._state.x,this._state.y,this._state.width,1),this._state={x:0,y:0,isFocused:!1,style:"",width:0})}_renderBarCursor(t,e,i,s){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillLeftLineAtCell(e,i,t.getOption("cursorWidth")),this._ctx.restore()}_renderBlockCursor(t,e,i,s){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillCells(e,i,s.getWidth(),1),this._ctx.fillStyle=this._colors.cursorAccent.css,this._fillCharTrueColor(t,s,e,i),this._ctx.restore()}_renderUnderlineCursor(t,e,i,s){this._ctx.save(),this._ctx.fillStyle=this._colors.cursor.css,this._fillBottomLineAtCells(e,i),this._ctx.restore()}_renderBlurCursor(t,e,i,s){this._ctx.save(),this._ctx.strokeStyle=this._colors.cursor.css,this._strokeRectAtCell(e,i,s.getWidth(),1),this._ctx.restore()}}e.CursorRenderLayer=n;class o{constructor(t,e){this._renderCallback=e,this.isCursorVisible=!0,a(t)&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}restartBlinkAnimation(t){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})))}_restartInterval(t=600){this._blinkInterval&&window.clearInterval(this._blinkInterval),this._blinkStartTimeout=window.setTimeout(()=>{if(this._animationTimeRestarted){const t=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,t>0)return void this._restartInterval(t)}this.isCursorVisible=!1,this._animationFrame=window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0}),this._blinkInterval=window.setInterval(()=>{if(this._animationTimeRestarted){const t=600-(Date.now()-this._animationTimeRestarted);return this._animationTimeRestarted=void 0,void this._restartInterval(t)}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=window.requestAnimationFrame(()=>{this._renderCallback(),this._animationFrame=void 0})},600)},t)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(window.clearInterval(this._blinkInterval),this._blinkInterval=void 0),this._blinkStartTimeout&&(window.clearTimeout(this._blinkStartTimeout),this._blinkStartTimeout=void 0),this._animationFrame&&(window.cancelAnimationFrame(this._animationFrame),this._animationFrame=void 0)}resume(t){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation(t)}}function a(t){return document.activeElement===t.textarea&&document.hasFocus()}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Utf8ToUtf32=e.StringToUtf32=e.utf32ToString=e.stringFromCodePoint=void 0,e.stringFromCodePoint=function(t){return t>65535?(t-=65536,String.fromCharCode(55296+(t>>10))+String.fromCharCode(t%1024+56320)):String.fromCharCode(t)},e.utf32ToString=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=t.length);for(var s="",r=e;r<i;++r){var n=t[r];n>65535?(n-=65536,s+=String.fromCharCode(55296+(n>>10))+String.fromCharCode(n%1024+56320)):s+=String.fromCharCode(n)}return s};var s=function(){function t(){this._interim=0}return t.prototype.clear=function(){this._interim=0},t.prototype.decode=function(t,e){var i=t.length;if(!i)return 0;var s=0,r=0;this._interim&&(56320<=(a=t.charCodeAt(r++))&&a<=57343?e[s++]=1024*(this._interim-55296)+a-56320+65536:(e[s++]=this._interim,e[s++]=a),this._interim=0);for(var n=r;n<i;++n){var o=t.charCodeAt(n);if(55296<=o&&o<=56319){if(++n>=i)return this._interim=o,s;var a;56320<=(a=t.charCodeAt(n))&&a<=57343?e[s++]=1024*(o-55296)+a-56320+65536:(e[s++]=o,e[s++]=a)}else e[s++]=o}return s},t}();e.StringToUtf32=s;var r=function(){function t(){this.interim=new Uint8Array(3)}return t.prototype.clear=function(){this.interim.fill(0)},t.prototype.decode=function(t,e){var i=t.length;if(!i)return 0;var s,r,n,o,a=0,l=0,h=0;if(this.interim[0]){var c=!1,d=this.interim[0];d&=192==(224&d)?31:224==(240&d)?15:7;for(var _=0,u=void 0;(u=63&this.interim[++_])&&_<4;)d<<=6,d|=u;for(var f=192==(224&this.interim[0])?2:224==(240&this.interim[0])?3:4,g=f-_;h<g;){if(h>=i)return 0;if(128!=(192&(u=t[h++]))){h--,c=!0;break}this.interim[_++]=u,d<<=6,d|=63&u}c||(2===f?d<128?h--:e[a++]=d:3===f?d<2048||d>=55296&&d<=57343||(e[a++]=d):d<65536||d>1114111||(e[a++]=d)),this.interim.fill(0)}for(var C=i-4,p=h;p<i;){for(;!(!(p<C)||128&(s=t[p])||128&(r=t[p+1])||128&(n=t[p+2])||128&(o=t[p+3]));)e[a++]=s,e[a++]=r,e[a++]=n,e[a++]=o,p+=4;if((s=t[p++])<128)e[a++]=s;else if(192==(224&s)){if(p>=i)return this.interim[0]=s,a;if(128!=(192&(r=t[p++]))){p--;continue}if((l=(31&s)<<6|63&r)<128){p--;continue}e[a++]=l}else if(224==(240&s)){if(p>=i)return this.interim[0]=s,a;if(128!=(192&(r=t[p++]))){p--;continue}if(p>=i)return this.interim[0]=s,this.interim[1]=r,a;if(128!=(192&(n=t[p++]))){p--;continue}if((l=(15&s)<<12|(63&r)<<6|63&n)<2048||l>=55296&&l<=57343)continue;e[a++]=l}else if(240==(248&s)){if(p>=i)return this.interim[0]=s,a;if(128!=(192&(r=t[p++]))){p--;continue}if(p>=i)return this.interim[0]=s,this.interim[1]=r,a;if(128!=(192&(n=t[p++]))){p--;continue}if(p>=i)return this.interim[0]=s,this.interim[1]=r,this.interim[2]=n,a;if(128!=(192&(o=t[p++]))){p--;continue}if((l=(7&s)<<18|(63&r)<<12|(63&n)<<6|63&o)<65536||l>1114111)continue;e[a++]=l}}return a},t}();e.Utf8ToUtf32=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RectangleRenderer=void 0;const s=i(0),r=i(3),n=i(2),o=8*Float32Array.BYTES_PER_ELEMENT;e.RectangleRenderer=class{constructor(t,e,i,r){this._terminal=t,this._colors=e,this._gl=i,this._dimensions=r,this._vertices={count:0,attributes:new Float32Array(160),selection:new Float32Array(24)};const n=this._gl;this._program=s.throwIfFalsy(s.createProgram(n,"#version 300 es\nlayout (location = 0) in vec2 a_position;\nlayout (location = 1) in vec2 a_size;\nlayout (location = 2) in vec4 a_color;\nlayout (location = 3) in vec2 a_unitquad;\n\nuniform mat4 u_projection;\nuniform vec2 u_resolution;\n\nout vec4 v_color;\n\nvoid main() {\n  vec2 zeroToOne = (a_position + (a_unitquad * a_size)) / u_resolution;\n  gl_Position = u_projection * vec4(zeroToOne, 0.0, 1.0);\n  v_color = a_color;\n}","#version 300 es\nprecision lowp float;\n\nin vec4 v_color;\n\nout vec4 outColor;\n\nvoid main() {\n  outColor = v_color;\n}")),this._resolutionLocation=s.throwIfFalsy(n.getUniformLocation(this._program,"u_resolution")),this._projectionLocation=s.throwIfFalsy(n.getUniformLocation(this._program,"u_projection")),this._vertexArrayObject=n.createVertexArray(),n.bindVertexArray(this._vertexArrayObject);const a=new Float32Array([0,0,1,0,0,1,1,1]),l=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,l),n.bufferData(n.ARRAY_BUFFER,a,n.STATIC_DRAW),n.enableVertexAttribArray(3),n.vertexAttribPointer(3,2,this._gl.FLOAT,!1,0,0);const h=new Uint8Array([0,1,3,0,2,3]),c=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,c),n.bufferData(n.ELEMENT_ARRAY_BUFFER,h,n.STATIC_DRAW),this._attributesBuffer=s.throwIfFalsy(n.createBuffer()),n.bindBuffer(n.ARRAY_BUFFER,this._attributesBuffer),n.enableVertexAttribArray(0),n.vertexAttribPointer(0,2,n.FLOAT,!1,o,0),n.vertexAttribDivisor(0,1),n.enableVertexAttribArray(1),n.vertexAttribPointer(1,2,n.FLOAT,!1,o,2*Float32Array.BYTES_PER_ELEMENT),n.vertexAttribDivisor(1,1),n.enableVertexAttribArray(2),n.vertexAttribPointer(2,4,n.FLOAT,!1,o,4*Float32Array.BYTES_PER_ELEMENT),n.vertexAttribDivisor(2,1),this._updateCachedColors()}render(){const t=this._gl;t.useProgram(this._program),t.bindVertexArray(this._vertexArrayObject),t.uniformMatrix4fv(this._projectionLocation,!1,s.PROJECTION_MATRIX),t.uniform2f(this._resolutionLocation,t.canvas.width,t.canvas.height),t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,this._vertices.attributes,t.DYNAMIC_DRAW),t.drawElementsInstanced(this._gl.TRIANGLES,6,t.UNSIGNED_BYTE,0,this._vertices.count),t.bindBuffer(t.ARRAY_BUFFER,this._attributesBuffer),t.bufferData(t.ARRAY_BUFFER,this._vertices.selection,t.DYNAMIC_DRAW),t.drawElementsInstanced(this._gl.TRIANGLES,6,t.UNSIGNED_BYTE,0,3)}onResize(){this._updateViewportRectangle()}setColors(){this._updateCachedColors(),this._updateViewportRectangle()}_updateCachedColors(){this._bgFloat=this._colorToFloat32Array(this._colors.background),this._selectionFloat=this._colorToFloat32Array(this._colors.selectionOpaque)}_updateViewportRectangle(){this._addRectangleFloat(this._vertices.attributes,0,0,0,this._terminal.cols*this._dimensions.scaledCellWidth,this._terminal.rows*this._dimensions.scaledCellHeight,this._bgFloat)}updateSelection(t){const e=this._terminal;if(t.hasSelection)if(t.columnSelectMode){const e=t.startCol,i=t.endCol-e,s=t.viewportCappedEndRow-t.viewportCappedStartRow+1;this._addRectangleFloat(this._vertices.selection,0,e*this._dimensions.scaledCellWidth,t.viewportCappedStartRow*this._dimensions.scaledCellHeight,i*this._dimensions.scaledCellWidth,s*this._dimensions.scaledCellHeight,this._selectionFloat),r.fill(this._vertices.selection,0,8)}else{const i=t.viewportStartRow===t.viewportCappedStartRow?t.startCol:0,s=t.viewportCappedStartRow===t.viewportEndRow?t.endCol:e.cols;this._addRectangleFloat(this._vertices.selection,0,i*this._dimensions.scaledCellWidth,t.viewportCappedStartRow*this._dimensions.scaledCellHeight,(s-i)*this._dimensions.scaledCellWidth,this._dimensions.scaledCellHeight,this._selectionFloat);const n=Math.max(t.viewportCappedEndRow-t.viewportCappedStartRow-1,0);if(this._addRectangleFloat(this._vertices.selection,8,0,(t.viewportCappedStartRow+1)*this._dimensions.scaledCellHeight,e.cols*this._dimensions.scaledCellWidth,n*this._dimensions.scaledCellHeight,this._selectionFloat),t.viewportCappedStartRow!==t.viewportCappedEndRow){const i=t.viewportEndRow===t.viewportCappedEndRow?t.endCol:e.cols;this._addRectangleFloat(this._vertices.selection,16,0,t.viewportCappedEndRow*this._dimensions.scaledCellHeight,i*this._dimensions.scaledCellWidth,this._dimensions.scaledCellHeight,this._selectionFloat)}else r.fill(this._vertices.selection,0,16)}else r.fill(this._vertices.selection,0,0)}updateBackgrounds(t){const e=this._terminal,i=this._vertices;let s=1;for(let r=0;r<e.rows;r++){let o=-1,a=0,l=0,h=!1;for(let c=0;c<e.cols;c++){const d=(r*e.cols+c)*n.RENDER_MODEL_INDICIES_PER_CELL,_=t.cells[d+n.RENDER_MODEL_BG_OFFSET],u=t.cells[d+n.RENDER_MODEL_FG_OFFSET],f=!!(67108864&u);if(_!==a||u!==l&&(h||f)){if(0!==a||h&&0!==l){const t=8*s++;this._updateRectangle(i,t,l,a,o,c,r)}o=c,a=_,l=u,h=f}}if(0!==a||h&&0!==l){const t=8*s++;this._updateRectangle(i,t,l,a,o,e.cols,r)}}i.count=s}_updateRectangle(t,e,i,r,n,o,a){let l;if(67108864&i)switch(50331648&i){case 16777216:case 33554432:l=this._colors.ansi[255&i].rgba;break;case 50331648:l=(16777215&i)<<8;break;case 0:default:l=this._colors.foreground.rgba}else switch(50331648&r){case 16777216:case 33554432:l=this._colors.ansi[255&r].rgba;break;case 50331648:l=(16777215&r)<<8;break;case 0:default:l=this._colors.background.rgba}t.attributes.length<e+4&&(t.attributes=s.expandFloat32Array(t.attributes,this._terminal.rows*this._terminal.cols*8));const h=n*this._dimensions.scaledCellWidth,c=a*this._dimensions.scaledCellHeight,d=(l>>24&255)/255,_=(l>>16&255)/255,u=(l>>8&255)/255;this._addRectangle(t.attributes,e,h,c,(o-n)*this._dimensions.scaledCellWidth,this._dimensions.scaledCellHeight,d,_,u,1)}_addRectangle(t,e,i,s,r,n,o,a,l,h){t[e]=i,t[e+1]=s,t[e+2]=r,t[e+3]=n,t[e+4]=o,t[e+5]=a,t[e+6]=l,t[e+7]=h}_addRectangleFloat(t,e,i,s,r,n,o){t[e]=i,t[e+1]=s,t[e+2]=r,t[e+3]=n,t[e+4]=o[0],t[e+5]=o[1],t[e+6]=o[2],t[e+7]=o[3]}_colorToFloat32Array(t){return new Float32Array([(t.rgba>>24&255)/255,(t.rgba>>16&255)/255,(t.rgba>>8&255)/255,(255&t.rgba)/255])}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.getDisposeArrayDisposable=e.disposeArray=e.Disposable=void 0;var s=function(){function t(){this._disposables=[],this._isDisposed=!1}return t.prototype.dispose=function(){this._isDisposed=!0;for(var t=0,e=this._disposables;t<e.length;t++){e[t].dispose()}this._disposables.length=0},t.prototype.register=function(t){return this._disposables.push(t),t},t.prototype.unregister=function(t){var e=this._disposables.indexOf(t);-1!==e&&this._disposables.splice(e,1)},t}();function r(t){for(var e=0,i=t;e<i.length;e++){i[e].dispose()}t.length=0}e.Disposable=s,e.disposeArray=r,e.getDisposeArrayDisposable=function(t){return{dispose:function(){return r(t)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.forwardEvent=e.EventEmitter=void 0;var s=function(){function t(){this._listeners=[],this._disposed=!1}return Object.defineProperty(t.prototype,"event",{get:function(){var t=this;return this._event||(this._event=function(e){return t._listeners.push(e),{dispose:function(){if(!t._disposed)for(var i=0;i<t._listeners.length;i++)if(t._listeners[i]===e)return void t._listeners.splice(i,1)}}}),this._event},enumerable:!1,configurable:!0}),t.prototype.fire=function(t,e){for(var i=[],s=0;s<this._listeners.length;s++)i.push(this._listeners[s]);for(s=0;s<i.length;s++)i[s].call(void 0,t,e)},t.prototype.dispose=function(){this._listeners&&(this._listeners.length=0),this._disposed=!0},t}();e.EventEmitter=s,e.forwardEvent=function(t,e){return t((function(t){return e.fire(t)}))}}])}));
//# sourceMappingURL=xterm-addon-aframe.js.map